(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{155:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),s=n(8),l=n.n(s),i=(n(90),n(15)),o=n(18),c=n(16),u=n(12),p=n(17),m=(n(93),n(20)),h=n.n(m),f=function(e){function t(e){var n;Object(i.a)(this,t),console.log("<SoundMachineInstrument>constructor",e.key);var a={C3:e.samples[0],"C#3":e.samples[1],D3:e.samples[2]};return(n=Object(c.a)(this,Object(u.a)(t).call(this,a,{baseUrl:e.baseUrl||"./audio/"+e.key+"/"}))).key=e.key,n}return Object(p.a)(t,e),t}(m.Sampler),d={ACCENT_1:0,ACCENT_2:1,ACCENT_3:2},b={TABLA:"tabla",ELECTRO_KIT:"electrokit"},g=function(e){function t(e){var n;Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this))).state={},n.lib={},n.currentInstrument=void 0;var a=new f({key:b.TABLA,label:"Tabla",samples:["dha-slide.wav","dhin-slide.wav","tin.wav"]}).toMaster();n.lib[a.key]=a;var r=new f({key:b.ELECTRO_KIT,label:"Electronic Kit",samples:["Kick.wav","HiHat.wav","Snare.wav"]}).toMaster();return n.lib[r.key]=r,n.setInstrument(e),console.log("<InstrumentLib>done constructor"),n}return Object(p.a)(t,e),Object(o.a)(t,[{key:"setInstrument",value:function(e){if(void 0===this.lib[e])throw new Error("InstrumentLib has no such instrument with given key: "+e);this.currentInstrument=e}},{key:"getInstrument",value:function(){if(void 0===this.lib[this.currentInstrument])throw new Error("There is no such instrument in InstrumentLib: "+this.currentInstrument);return this.lib[this.currentInstrument]}}]),t}(a.Component),v=function(e){function t(e){var n;if(Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).beatsPerStep=3,n.accentNotes=["C3","C#3","D3"],n.instrumentLib=void 0,n.state={isPlaying:!1},n.accents=[d.ACCENT_1],n.samples={},n.instruments={},n.part=null,n.setBpm=function(e){h.a.Transport.bpm.value=e},n.setBeatsPerStep=function(e){n.beatsPerStep=e,console.log("<SoundMachine>setBeatsPerStep",e),n.restart()},n.restart=function(){console.log("<SoundMachine>restart()");var e=n.instrumentLib.getInstrument();console.log("sampler.key",e.key),n.part&&(console.log("clearing this.part"),n.part.stop(),n.part.removeAll(),n.part.dispose(),n.part=void 0);for(var t=[],a=0;a<n.beatsPerStep;a++)t.push(["0:"+a,n.accentNotes[d.ACCENT_2]]);n.part=new h.a.Part(function(t,n){e.triggerAttackRelease(n,"4n",t)},t),n.setAccents(n.accents),console.log("setting timeSignature",n.beatsPerStep),h.a.Transport.timeSignature=[n.beatsPerStep,4],n.part.loopEnd="1m",n.part.loop=!0,console.log("transpor was playing so play part"),n.part.start(0)},n.getBpm=function(){return h.a.Transport.bpm.value},!e.beatsPerStep)throw new Error("props.beatsPerStep is missing");return n.beatsPerStep=e.beatsPerStep,n.instrumentLib=new g(n.props.instrument),n}return Object(p.a)(t,e),Object(o.a)(t,[{key:"onBufferError",value:function(){throw new Error("Some buffers weren't found")}},{key:"componentDidMount",value:function(){var e=this;(new h.a.Synth).toMaster().triggerAttackRelease("A2"),h.a.Buffer.on("error",function(){return e.onBufferError()}),h.a.context.latencyHint="playback"}},{key:"setInstrument",value:function(e){console.log("<SoundMachine>new instrument",e),this.instrumentLib.setInstrument(e),this.restart()}},{key:"setAccents",value:function(e){this.accents=e;for(var t=0;t<this.part.length;t++){var n=this.accentNotes[d.ACCENT_2];void 0!==e[t]&&e[t]===d.ACCENT_1?n=this.accentNotes[d.ACCENT_1]:void 0!==e[t]&&e[t]===d.ACCENT_3&&(n=this.accentNotes[d.ACCENT_3]),this.part.at("0:"+t,n)}}},{key:"render",value:function(){return r.a.createElement("div",null,"Sound is ",!0===this.state.isPlaying?"playing":"stopped")}},{key:"stop",value:function(){console.log("<SoundMachine>stop()"),this.setState({isPlaying:!1}),h.a.Transport.stop()}},{key:"start",value:function(){console.log("<SoundMachine>start()"),this.setState({isPlaying:!0}),h.a.Transport.start("+0.1"),this.restart()}}]),t}(a.Component),E=n(156),k=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={currentStep:0,bars:[]},n.timer={ref:null,startTime:null},n.stepsCounter=0,n.planChanged=function(){console.log("<Planner>planChanged"),n.props.onChange&&n.props.onChange()},n.barRender=function(e){var t=n.state.currentStep===e.step?"current-step":"";return r.a.createElement("div",{onClick:function(){return n.onStepClick(e.step)},className:"step "+t,key:"key_"+e.bpm},n.formatTime(e.segmentDuration.toFixed(0))," at"," ",e.bpm.toFixed(0))},n}return Object(p.a)(t,e),Object(o.a)(t,[{key:"setPlan",value:function(e){var t=this;console.log("<Planner>setPlan",e);for(var n=[],a=0;a<e.length;a++){var r={time:e[a].time,timeEnd:e[a].end,segmentDuration:e[a].end-e[a].time,startTimeFormatted:this.formatTime(e[a].start),endTimeFormatted:this.formatTime(e[a].end),bpm:e[a].bpm,step:this.stepsCounter++};n.push(r)}this.stepsCounter=0,this.setState(function(e){return{currentStep:0,bars:n}},function(){return t.planChanged()})}},{key:"stop",value:function(){console.log("lockBpm",this.props.lockBpm),this.timer&&this.disposeTimer(this.timer.ref),this.resetStep()}},{key:"disposeTimer",value:function(e){if(this.timer.ref!==e)throw new Error("Wront timer.ref to dispose");console.log("<Planner>clearing interval, ",this.timer.ref),clearInterval(this.timer.ref),this.timer.ref=void 0,this.timer.startTime=null,this.timer=void 0}},{key:"onInterval",value:function(){if(console.log("<Planner>onInterval"),this.props.lockBpm)console.log("<Planner>isLocked == true so don't advance anything");else{var e=this.state.currentStep;if(e+1>=this.state.bars.length)return console.log("no more steps, please stop()"),this.disposeTimer(this.timer.ref),void this.props.onAdvance(null);console.log("<Planner>onInterval",this.state.currentStep+1),this.setState({currentStep:e+1}),this.props.onAdvance(this.state.bars[this.state.currentStep])}}},{key:"start",value:function(){console.log("<Planner>start()"),this.timer&&(clearInterval(this.timer.ref),this.timer.ref=void 0,this.timer.startTime=null,this.resetStep());var e=1e3*(this.state.bars[this.state.currentStep].timeEnd-this.state.bars[this.state.currentStep].time),t=this.onInterval.bind(this);console.log("setting interval",e),this.timer={ref:setInterval(t,e),startTime:new Date}}},{key:"clear",value:function(){this.stepsCounter=0,this.setState({bars:[],currentStep:0}),this.planChanged()}},{key:"resetStep",value:function(){this.setState({currentStep:0}),this.props.onAdvance(this.state.bars[0])}},{key:"getCurrentBar",value:function(){if(this.state.currentStep>=this.state.bars.length)throw new Error("Trying to get step that doesn't exists");return this.state.bars[this.state.currentStep]}},{key:"onStepClick",value:function(e){var t=this;this.setState({currentStep:e},function(){return t.props.onAdvance(t.state.bars[t.state.currentStep])})}},{key:"render",value:function(){var e=this;return 0===this.state.bars.length?r.a.createElement("div",null,"No plan"):r.a.createElement(E.a,{className:"Planner"},r.a.createElement("div",{style:this.props.lockBpm?{opacity:.5}:{}},this.state.bars.map(function(t){return e.barRender(t)})))}},{key:"padTime",value:function(e){return e<10?"0"+e:e}},{key:"formatTime",value:function(e){var t=new Date(0,0,0,0,0,0,0);t.setSeconds(e);var n="";return 0!==t.getMinutes()&&(n+=t.getMinutes(),n+=":"),n+=this.padTime(t.getSeconds())+"s"}}]),t}(a.Component),y=(n(97),n(99),n(159)),C=n(160),S=n(154),P=n(164),T=n(161),A=n(163),B=n(162),O=n(47),w=n(46),N=n(157),j=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,Object(O.a)(Object(u.a)(t.prototype),"render",this).call(this),r.a.createElement("div",null,r.a.createElement(N.a,{onClick:this.onBadgeClick,className:"d-i"},this.state.value)))}},{key:"onBadgeClick",value:function(){}}]),t}(w.b),I=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,Object(O.a)(Object(u.a)(t.prototype),"render",this).call(this),r.a.createElement(N.a,{onClick:this.onBadgeClick,className:"d-i"},this.state.bounds[0]," - ",this.state.bounds[1]))}}]),t}(w.a),x=n(84),R=n(158),M=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={bars:[]},n.accents=[d.ACCENT_1,d.ACCENT_2,d.ACCENT_3],n.renderCells=function(e){return e.map(function(e){return r.a.createElement(S.a,{size:"sm",color:n.getBtnColor(e.type),key:"barkey_"+e.idx,onClick:function(){return n.handleCellClick(e.idx)}},e.idx+1)})},n.state.bars=n.prepareBars(e.defaultValue),n.state.bars[0].type=d.ACCENT_1,n}return Object(p.a)(t,e),Object(o.a)(t,[{key:"prepareBars",value:function(e){for(var t=this.getValue(),n=[],a=0;a<e;a++)n.push({idx:a,type:void 0!==t[a]?t[a]:d.ACCENT_2});return n}},{key:"setBarsAmount",value:function(e){var t=this.prepareBars(e);this.setState({bars:Object(x.a)(t)},this.props.onAfterChange)}},{key:"handleCellClick",value:function(e){var t=this.state.bars[e].type,n=this.accents[(t+1)%3];this.state.bars[e].type=n,this.forceUpdate()}},{key:"getValue",value:function(){for(var e=[],t=0;t<this.state.bars.length;t++)e.push(this.state.bars[t].type);return e}},{key:"getBtnColor",value:function(e){var t;switch(e){case d.ACCENT_2:t="secondary";break;case d.ACCENT_3:t="warning";break;default:t="primary"}return t}},{key:"render",value:function(){var e=this.props.onAfterChange;return r.a.createElement(R.a,{onClick:e},this.renderCells(this.state.bars))}}]),t}(a.Component),L=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).timer={timerRef:null,startTime:null},n.cycleLockType={SEGMENT:"segment",STEP:"step"},n.state={bpmRange:[200,400],exerciseDuration:60,totalSteps:10,beatsPerStep:4,currentBpm:60,instrument:b.ELECTRO_KIT,constantMode:n.cycleLockType.STEP,instrumentDropdownOpen:!1,cycleDropdownOpen:!1,lockBpm:!1},n.totalStepsChanged=function(){var e=n.getUiState();e.totalSteps!==n.state.totalSteps&&n.refs.planner.setPlan(n.makePlan(e))},n.onBeatsPerStepChange=function(){var e=n.getUiState();if(e.beatsPerStep!==n.refs.sm.beatsPerStep)return n.refs.barManager.setBarsAmount(e.beatsPerStep),void n.refs.sm.setBeatsPerStep(e.beatsPerStep)},n.exerciseDurationChanged=function(){var e=n.makePlan(n.getUiState());n.refs.planner.setPlan(e)},n.onPlanAdvanced=function(e){e?(console.log("<App>plan advanced, setting new bpm",e.bpm),n.setBpm(e.bpm)):(n.refs.planner.stop(),n.refs.sm.stop())},n.setBpm=function(e){n.setState({currentBpm:e}),n.refs.sm.setBpm(e)},n.onPlanChanged=function(){console.log("<App>onPlanChanged");var e=n.refs.planner.getCurrentBar();console.log("<App>currentBar",e),console.log("<App>isPlaying?",n.refs.sm.state.isPlaying),e&&n.setBpm(e.bpm),n.refs.sm.state.isPlaying&&n.refs.planner.start()},n.handleStartStop=function(){console.log("<App>handleStartStop, isPlaying=",n.refs.sm.state.isPlaying),!0===n.refs.sm.state.isPlaying?(n.refs.planner.stop(),n.refs.sm.stop()):(n.refs.planner.start(),n.refs.sm.start())},n}return Object(p.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.refs.planner.setPlan(this.makePlan(this.getUiState()))}},{key:"onInstrumentSelect",value:function(e){this.refs.sm.setInstrument(e),this.setState({instrument:e})}},{key:"onCycleSelect",value:function(e){this.setState({constantMode:e})}},{key:"renderCyclePane",value:function(){var e=this;return r.a.createElement(E.a,{className:"pane"},r.a.createElement(y.a,{className:"pane-title"},"CYCLE"),r.a.createElement(y.a,null,r.a.createElement(C.a,{xs:3},"Total time (min)"),r.a.createElement(C.a,null,r.a.createElement(j,{ref:"exerciseDuration",min:1,max:30,defaultValue:this.state.exerciseDuration/60,onAfterChange:function(){return e.exerciseDurationChanged()}}))),r.a.createElement(y.a,null,r.a.createElement(C.a,{xs:3},"Beats per step"),r.a.createElement(C.a,null,r.a.createElement(j,{ref:"beatsPerStep",min:2,max:16,defaultValue:this.state.beatsPerStep,onAfterChange:function(){return e.onBeatsPerStepChange()}}))),r.a.createElement(y.a,null,r.a.createElement(C.a,{xs:3},"Number of steps"),r.a.createElement(C.a,null,r.a.createElement(j,{ref:"totalSteps",min:1,max:60,defaultValue:this.state.totalSteps,onAfterChange:function(){return e.totalStepsChanged()}}))),r.a.createElement(y.a,null,r.a.createElement(C.a,{xs:3},"Accents"),r.a.createElement(C.a,null,r.a.createElement(M,{onAfterChange:function(){return e.onAccentsChange()},ref:"barManager",defaultValue:this.state.beatsPerStep}))))}},{key:"renderTempoPane",value:function(){var e=this;return r.a.createElement(E.a,{className:"pane"},r.a.createElement(y.a,{className:"pane-title"},"TEMPO"),r.a.createElement(y.a,null,r.a.createElement(C.a,{xs:"3"},"BPM"),r.a.createElement(C.a,null,r.a.createElement(I,{ref:"bpmRange",min:30,max:600,defaultValue:[this.state.bpmRange[0],this.state.bpmRange[1]],pushable:!0,onAfterChange:function(){return e.onBpmRangeChange()}}))))}},{key:"renderPlaybackPane",value:function(){var e=this;return r.a.createElement(E.a,{className:"pane"},r.a.createElement(y.a,{className:"pane-title"},"PLAYBACK"),r.a.createElement(y.a,null,r.a.createElement(C.a,{xs:"3"},"Instrument"),r.a.createElement(C.a,null,r.a.createElement(P.a,{isOpen:this.state.instrumentDropdownOpen,toggle:function(){return e.onInstrumentChange()}},r.a.createElement(T.a,{caret:!0},this.state.instrument),r.a.createElement(A.a,null,r.a.createElement(B.a,{onClick:function(){e.onInstrumentSelect(b.TABLA)}},"Tabla"),r.a.createElement(B.a,{onClick:function(){e.onInstrumentSelect(b.ELECTRO_KIT)}},"Electro"))))))}},{key:"renderLeftPane",value:function(){return r.a.createElement(E.a,{className:"side-panel"},r.a.createElement(y.a,null,r.a.createElement(C.a,null,this.renderTempoPane())),r.a.createElement(y.a,null,r.a.createElement(C.a,null,this.renderPlaybackPane())),r.a.createElement(y.a,null,r.a.createElement(C.a,null,this.renderCyclePane())))}},{key:"renderExamplesPane",value:function(){return r.a.createElement(E.a,{className:"pane"},r.a.createElement(y.a,{className:"pane-title"},"EXAMPLES"),r.a.createElement(y.a,null,"Not implemented"))}},{key:"renderPlanPane",value:function(){var e=this;return r.a.createElement(E.a,{className:"pane"},r.a.createElement(y.a,{className:"pane-title"},"Plan"),r.a.createElement(y.a,null,r.a.createElement(k,{constantMode:this.state.constantMode,lockBpm:this.state.lockBpm,onChange:function(){return e.onPlanChanged()},onAdvance:function(t){return e.onPlanAdvanced(t)},ref:"planner"})))}},{key:"renderRightPane",value:function(){return r.a.createElement(E.a,{className:"side-panel"},r.a.createElement(y.a,null,r.a.createElement(C.a,null,r.a.createElement(E.a,{className:"pane"},r.a.createElement(y.a,{className:"pane-title"},"BPM"),r.a.createElement(y.a,{className:this.state.lockBpm?"locked":""},r.a.createElement(C.a,null," ",this.state.currentBpm.toFixed(0)))))),r.a.createElement(y.a,null,r.a.createElement(C.a,null,this.renderPlanPane())))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"App"},r.a.createElement(v,{ref:"sm",beatsPerStep:this.state.beatsPerStep,instrument:this.state.instrument}),r.a.createElement(E.a,null,r.a.createElement(y.a,null,r.a.createElement(C.a,null,this.renderLeftPane()),r.a.createElement(C.a,{sm:"4"},this.renderRightPane())),r.a.createElement(y.a,null,r.a.createElement(C.a,null,r.a.createElement(S.a,{onClick:function(){return e.handleStartStop()},block:!0},"Start / Stop")),r.a.createElement(C.a,null,r.a.createElement(S.a,{onClick:function(){return e.onLockBpmBtn()}},"Lock BPM")))))}},{key:"onLockBpmBtn",value:function(){this.setState({lockBpm:!this.state.lockBpm})}},{key:"onBpmRangeChange",value:function(){var e=this.getUiState();e.bpmRange[0]===this.state.bpmRange[0]&&e.bpmRange[1]===this.state.bpmRange[1]||(console.log("bpm range changed"),console.log(e,this.state),this.setState({bpmRange:e.bpmRange}),this.refs.planner.setPlan(this.makePlan(e)))}},{key:"onInstrumentChange",value:function(){this.setState(function(e){return{instrumentDropdownOpen:!e.instrumentDropdownOpen}})}},{key:"getUiState",value:function(){return{bpmRange:this.refs.bpmRange.getValue(),exerciseDuration:this.refs.exerciseDuration.getValue(),totalSteps:this.refs.totalSteps.getValue(),beatsPerStep:this.refs.beatsPerStep.getValue()}}},{key:"onAccentsChange",value:function(){this.refs.sm.setAccents(this.refs.barManager.getValue())}},{key:"makePlan",value:function(e){var t=e.bpmRange[0],n=(e.bpmRange[1]-t)/e.totalSteps,a=60*e.exerciseDuration/(e.totalSteps+1);console.log("<App>makePlan, excerciseDuration:",e.exerciseDuration);for(var r=[],s=0;s<=e.totalSteps;s++)r.push({time:s*a,start:s*a,end:s*a+a,bpm:t+s*n});return r}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(L,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},85:function(e,t,n){e.exports=n(155)},90:function(e,t,n){},93:function(e,t,n){}},[[85,2,1]]]);
//# sourceMappingURL=main.4ffd8753.chunk.js.map