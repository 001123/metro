(this.webpackJsonpmetro=this.webpackJsonpmetro||[]).push([[0],{103:function(e,t,a){},107:function(e,t,a){},172:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),s=a(15),i=a.n(s),o=(a(103),a(53)),l=a(38),c=a(9),u=a(16),p=a(13),h=a(7),m=a(14),f=(a(107),a(17)),d=a.n(f),b={ACCENT_1:0,ACCENT_2:1,ACCENT_3:2},v=[b.ACCENT_1,b.ACCENT_2,b.ACCENT_3],g=function(e){function t(e){var a;Object(c.a)(this,t);var n={C3:e.samples[0],"C#3":e.samples[1],D3:e.samples[2]};return(a=Object(p.a)(this,Object(h.a)(t).call(this,n,{baseUrl:e.baseUrl||"./audio/"+e.key+"/"}))).key=e.key,a.label=e.label,a}return Object(m.a)(t,e),t}(f.Sampler),y={TABLA:"tabla",ELECTRO_KIT:"electrokit",METRONOME:"metronome"},E=function(e){function t(e){var a;Object(c.a)(this,t),(a=Object(p.a)(this,Object(h.a)(t).call(this))).state={},a.lib={},a.currentInstrument=void 0,a.fft=void 0;var n=new g({key:y.TABLA,label:"Tabla",samples:["dha-slide.wav","dhin-slide.wav","tin.wav"]});a.lib[n.key]=n;var r=new g({key:y.ELECTRO_KIT,label:"Electronic Kit",samples:["Kick.wav","HiHat.wav","Snare.wav"]});a.lib[r.key]=r;var s=new g({key:y.METRONOME,label:"Metronome",samples:["tap.wav","down.wav","up.wav"]});return a.lib[s.key]=s,a.setInstrument(e),a.fft=new d.a.FFT(128),r.fan(a.fft).toMaster(),n.fan(a.fft).toMaster(),s.fan(a.fft).toMaster(),a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"setInstrument",value:function(e){if(void 0===this.lib[e])throw new Error("InstrumentLib has no such instrument with given key: "+e);this.currentInstrument=e}},{key:"getInstrument",value:function(){if(void 0===this.lib[this.currentInstrument])throw new Error("There is no such instrument in InstrumentLib: "+this.currentInstrument);return this.lib[this.currentInstrument]}}]),t}(n.Component),S=a(90),k={BY_BAR:"by_bar",BY_TIME:"by_time",STABLE:"stable"},C=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(p.a)(this,Object(h.a)(t).call(this,e))).accentNotes=["C3","C#3","D3"],a.instrumentLib=void 0,a.currentBeat=0,a.beatsPerStep=4,a.progressRefreshRate=1e3/60,a.score=["C3","C#3","C#3","C#3"],a.state={isPlaying:!1},a.accents=[b.ACCENT_1],a.executeStep=function(e){if(a.lastStep!==e){a.lastStep=e,a.currentStep=e,a.getBpm()!==e.bpm&&a.setBpm(e.bpm);var t=a.currentStep.playMode===k.BY_TIME?e.duration:e.duration+"m";d.a.Transport.setLoopPoints(0,t),d.a.Transport.lastLoopDuration=a.currentStep.duration}"stopped"===d.a.Transport.state&&d.a.Transport.start("+0.01")},a.repeat=function(e){var t=a.currentBeat++%a.beatsPerStep,n=a.score[t];a.instrumentLib.getInstrument().triggerAttack(n,e),d.a.Draw.schedule((function(){return a.onBeat(t)}),e)},a.setBpm=function(e){if(isNaN(e)||e<=0||e>1e3)throw new Error("Invalid BPM value: "+e);e!==d.a.Transport.bpm.value&&(d.a.Transport.bpm.value=e,d.a.Transport.loopEnd="1m")},a.setBeatsPerStep=function(e){for(a.beatsPerStep=e;a.score.length>e;)a.score.pop();for(;a.score.length<e;)a.score.push(b.ACCENT_1);d.a.Transport.timeSignature=e,d.a.Transport.loop=!0,a.setState({beatsPerStep:e})},a.onBeat=function(e){a.props.onBeat(e)},a.handleStartStop=function(){"started"===d.a.Transport.state?a.stop():a.start(a.currentStep)},a.getBpm=function(){return d.a.Transport.bpm.value},a.instrumentLib=new E(a.props.instrument),a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"onBufferError",value:function(){throw new Error("Some buffers weren't found")}},{key:"onStop",value:function(){this.props.onToggle(this.state.isPlaying),clearInterval(this.stepProgressUpdateTimer)}},{key:"onStart",value:function(){var e=this;this.props.onToggle(this.state.isPlaying),this.stepProgressUpdateTimer=setInterval((function(){return e.updateProgress()}),this.progressRefreshRate)}},{key:"componentDidMount",value:function(){var e=this;(new d.a.Synth).toMaster().triggerAttackRelease("A2"),d.a.Buffer.on("error",(function(){return e.onBufferError()})),d.a.Transport.on("stop",(function(){return e.onStop()})),d.a.Transport.on("start",(function(){return e.onStart()})),d.a.Transport.on("loop",(function(t){return e.props.onLoopEnd(t)})),d.a.context.latencyHint="playback",d.a.Transport.timeSignature=4,d.a.Transport.loop=!0,d.a.Transport.loopEnd="1m",this.loop=new d.a.Loop((function(t){return e.repeat(t)}),"4n"),this.loop.start()}},{key:"updateProgress",value:function(){this.props.onProgress(d.a.Transport.progress),this.vis&&this.vis.drawFFT(this.instrumentLib.fft.getValue())}},{key:"setStep",value:function(e){if(e!==this.currentStep)return this.currentStep=e,!0===this.state.isPlaying&&this.executeStep(e),this.currentStep.bpm}},{key:"setInstrument",value:function(e){this.instrumentLib.setInstrument(e)}},{key:"getCurrentInstrumentLabel",value:function(){return this.instrumentLib.getInstrument().label}},{key:"setAccents",value:function(e){this.accents=e;for(var t=0;t<this.score.length;t++){var a=this.accentNotes[b.ACCENT_2];void 0!==e[t]&&e[t]===b.ACCENT_1?a=this.accentNotes[b.ACCENT_1]:void 0!==e[t]&&e[t]===b.ACCENT_3&&(a=this.accentNotes[b.ACCENT_3]),this.score[t]=a}}},{key:"render",value:function(){var e=this;return r.a.createElement(S.a,{outline:!0,color:"light",onClick:function(){return e.handleStartStop()},block:!0,active:this.state.isPlaying},"Start / Stop")}},{key:"setVis",value:function(e){this.vis=e}},{key:"stop",value:function(){this.setState({isPlaying:!1}),this.currentBeat=0,d.a.Transport.stop()}},{key:"start",value:function(e){this.setState({isPlaying:!0},this.executeStep(e))}}]),t}(n.Component),P=C;C.defaultProps={beatsPerStep:4,onLoopEnd:function(e){},onToggle:function(e){},onProgress:function(e){}};var O=a(174),B=a(173),w=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(p.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement(B.a,{className:"SimpleProgress"},r.a.createElement("div",{className:"bar",style:{width:this.props.value+"%",display:"block"}}))}}]),t}(n.Component),T={padTime:function(e){return e<10?"0"+e:e},formatTime:function(e){var t=new Date(0,0,0,0,0,0,0);t.setSeconds(e);var a="";return 0!==t.getMinutes()?(a+=t.getMinutes(),a+=":",a+=""+T.padTime(t.getSeconds())):a+=t.getSeconds(),a}},M=T,j=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return(a=Object(p.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(s)))).state={bars:[],stepProgress:0,isPaused:!1},a.timer={ref:null,startTime:null},a.stepsCounter=0,a.barRender=function(e){var t=a.state.currentStep===e.step?"current-step":"";return r.a.createElement("div",{onClick:function(){return a.setStep(e.step)},className:"step "+t,key:"key_"+e.bpm},void 0!==e.segmentDuration?M.formatTime(e.segmentDuration.toFixed(0))+" ":e.end+" bars ","at ",e.bpm.toFixed(0))},a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"makePlan",value:function(e){var t=[];if(e.playMode===k.BY_BAR)for(var a=e.bpmRange[0],n=e.bpmRange[1],r=a;r<=n;){var s={bpm:r,duration:e.interval,end:e.interval};t.push(s),r+=e.bpmStep}else if(e.playMode===k.BY_TIME)for(var i=e.bpmRange[0],o=e.bpmRange[1],l=i;l<=o;){var c={time:0*e.interval,start:0*e.interval,end:0*e.interval+e.interval,duration:e.interval,bpm:l};t.push(c),l+=e.bpmStep}else if(e.playMode===k.STABLE){var u={time:1/0,duration:1/0,bpm:e.stableBpmSlider};t.push(u)}return t}},{key:"setPlan",value:function(e){var t=this,a=this.makePlan(e),n=[],r=0,s=e.playMode,i=0;switch(e.playMode){case k.BY_BAR:for(i=0;i<a.length;i++){var o={bpm:a[i].bpm,duration:a[i].end,end:a[i].end,step:this.stepsCounter++,playMode:k.BY_BAR};r+=60/a[i].bpm*e.beatsPerStep*a[i].end,n.push(o)}break;case k.BY_TIME:for(i=0;i<a.length;i++){var l={time:a[i].time,duration:a[i].end-a[i].time,timeEnd:a[i].end,segmentDuration:a[i].end-a[i].time,startTimeFormatted:M.formatTime(a[i].start),endTimeFormatted:M.formatTime(a[i].end),bpm:a[i].bpm,playMode:k.BY_TIME,step:this.stepsCounter++};r+=a[i].end,n.push(l)}break;case k.STABLE:r=1/0,n.push({bpm:a[0].bpm,duration:1/0,playMode:k.STABLE,time:1/0,step:0})}this.stepsCounter=0,this.setState((function(e){return{totalPlanTime:r,currentStep:0,bars:n,playMode:s}}),(function(){return t.stepChanged()}))}},{key:"stop",value:function(){this.pause(),this.resetStep()}},{key:"setStep",value:function(e){this.state.currentStep!==e&&this.setState({currentStep:e},this.stepChanged)}},{key:"isLastStep",value:function(){return this.state.currentStep===this.state.bars.length-1}},{key:"isFirstStep",value:function(){return 0===this.state.currentStep}},{key:"stepForward",value:function(){this.state.currentStep+1<this.state.bars.length&&this.setStep(this.state.currentStep+1)}},{key:"stepBackward",value:function(){this.state.currentStep-1>=0&&this.setStep(this.state.currentStep-1)}},{key:"start",value:function(){}},{key:"setProgress",value:function(e){this.setState({stepProgress:e})}},{key:"stepChanged",value:function(){var e=this.getCurrentStep();this.props.onStep(e)}},{key:"resetStep",value:function(){this.setStep(0)}},{key:"getCurrentStep",value:function(){if(this.state.currentStep>=this.state.bars.length)throw new Error("Trying to get step that doesn't exists");return this.state.bars[this.state.currentStep]}},{key:"formatTime",value:function(e){return e.getMinutes()+":"+e.getSeconds()}},{key:"render",value:function(){var e=this;return 0===this.state.bars.length?r.a.createElement("div",null,"No plan"):this.state.bars[0].time===1/0?r.a.createElement("div",null,r.a.createElement("h2",null,r.a.createElement(O.a,{color:"dark"},"BPM: ",this.props.currentBpm))):r.a.createElement("div",{className:"Planner"},r.a.createElement("h2",null,r.a.createElement(O.a,{color:"dark"},"BPM: ",this.props.currentBpm)),r.a.createElement(w,{value:100*this.state.stepProgress}),r.a.createElement("div",{style:this.props.lockBpm?{opacity:.5}:{}},this.state.bars.map((function(t){return e.barRender(t)}))),r.a.createElement("div",null,"Total time: ",M.formatTime(this.state.totalPlanTime)))}}]),t}(n.Component),A=j;j.defaultProps={playMode:k.BY_BAR,currentStep:0,onStep:function(e){}};a(110),a(111);var I=a(179),D=a(180),R=a(187),N=a(181),L=a(182),_=a(183),x=a(54),F=a(39),Y=function(e){function t(){return Object(c.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement(O.a,{color:"light",className:"d-i"},this.state.value)),r.a.createElement("div",{style:{height:"30px"}},r.a.createElement("div",null,Object(x.a)(Object(h.a)(t.prototype),"render",this).call(this))))}},{key:"onBadgeClick",value:function(){}}]),t}(F.b),V=a(97),U=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(p.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={isCurrent:!1},a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"Accent "+(!0===this.state.isCurrent?"active":""),onClick:this.props.onClick},r.a.createElement("div",{className:"type"+this.props.type}))}},{key:"toggleCurrent",value:function(){this.setState({isCurrent:!this.state.isCurrent})}}]),t}(n.Component),z=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={bars:[]},a.state.bars=e.defaultValue,a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"setAccents",value:function(e,t){this.setState({bars:e},this.props.onAfterChange)}},{key:"handleCellClick",value:function(e){var t=Object(V.a)(this.state.bars),a=t[e];t[e]=v[(a+1)%3],this.setState({bars:t},this.props.onAfterChange)}},{key:"getAccents",value:function(){return this.state.bars}},{key:"setActive",value:function(e){this.lastActiveAccent&&(this.lastActiveAccent.toggleCurrent(),this.lastActiveAccent=void 0);var t=this.refs["accent"+e];t&&(t.toggleCurrent(),this.lastActiveAccent=t)}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,this.state.bars.map((function(t,a){return r.a.createElement(U,{ref:"accent"+a,key:"accent"+a,type:t,onClick:function(){return e.handleCellClick(a)}})})))}}]),t}(n.Component),K=a(52),J=a(186),H=a(175),W=a(176),X=a(177),G=a(178);function q(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var $=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={modal:!1,preset:null,showDelete:!1},a.state={modal:!1},a.toggle=a.toggle.bind(Object(K.a)(a)),a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"toggle",value:function(){this.setState((function(e){return{modal:!e.modal}}))}},{key:"handleSave",value:function(){var e=this.state.preset,t=this.state.preset.title;t&&t.length>0&&(this.props.onSave(t,e),this.toggle())}},{key:"edit",value:function(e,t){this.setState({preset:e,showDelete:t},this.toggle)}},{key:"titleChanged",value:function(e){var t=e.target.value,a=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?q(a,!0).forEach((function(t){Object(l.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):q(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},this.state.preset);a.title=t,this.setState({preset:a})}},{key:"onDeleteBtn",value:function(){this.props.onDeleteBtn(this.state.preset),this.toggle()}},{key:"renderDelete",value:function(){var e=this;if(!0===this.state.showDelete)return r.a.createElement(S.a,{color:"warning",onClick:function(){return e.onDeleteBtn()}},"Delete")}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(S.a,{style:{marginTop:"0.5em"},outline:!0,size:"sm",color:"light",onClick:this.props.onSaveBtn},"Save current settings"),r.a.createElement(J.a,{isOpen:this.state.modal,toggle:this.toggle,className:this.props.className},r.a.createElement(H.a,{toggle:this.toggle},"Save Preset"),r.a.createElement(W.a,null,r.a.createElement(X.a,{onChange:function(t){return e.titleChanged(t)},defaultValue:this.state.preset&&this.state.preset.title||""}),r.a.createElement("div",{className:"code"},JSON.stringify(this.state.preset))),r.a.createElement(G.a,null,r.a.createElement(S.a,{color:"primary",onClick:function(){return e.handleSave()}},"Save")," ",r.a.createElement(S.a,{color:"secondary",onClick:this.toggle},"Cancel"),this.renderDelete())))}}]),t}(n.Component),Q=$;function Z(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ee(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Z(a,!0).forEach((function(t){Object(l.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Z(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}$.defaultProps={onDeleteBtn:function(e){},onSave:function(e,t){},onSaveBtn:function(e,t){}};var te=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={showDelete:[],showEdit:[]},a.userPresets=a.props.cookies.get("userPresets"),a.state.showDelete=a.userPresets?Array(a.userPresets.length).fill(!1):[],a.state.showEdit=a.userPresets?Array(a.userPresets.length).fill(!1):[],a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"onPresetClick",value:function(e){this.props.onSelect(e)}},{key:"onSavePreset",value:function(e,t){var a=ee({title:e},t),n=this.props.cookies.get("userPresets");n||(n=[]);for(var r=-1,s=0;s<n.length;s++)n[s].title.toLowerCase()===e.toLowerCase()&&(r=s);r<0?n.push(a):n[r]=a,this.saveInCookie(n)}},{key:"saveInCookie",value:function(e){this.props.cookies.set("userPresets",JSON.stringify(e),{path:"/"}),this.userPresets=e}},{key:"showDeleteBtn",value:function(e,t){var a=ee({},this.state);a[t]=!0,this.setState({showDelete:a})}},{key:"showEditBtn",value:function(e,t){var a=ee({},this.state);a[t]=!0,this.setState({showEdit:a})}},{key:"hideEditBtn",value:function(e){this.setState({showEdit:!1})}},{key:"onPresetDelete",value:function(e){var t=this.userPresets.indexOf(e);if(t<0)throw new Error("Selected preset "+e.title+" has not been found in the store");this.userPresets.splice(t,1),this.saveInCookie(this.userPresets)}},{key:"onPresetEdit",value:function(e,t){if(e.stopPropagation(),void 0!==t)this.refs.presetEditor.edit(this.userPresets[t],!0);else{var a=this.props.getPreset();this.refs.presetEditor.edit(a)}}},{key:"setPreset",value:function(e){}},{key:"render",value:function(){var e=this,t=this.props.cookies.cookies.userPresets?JSON.parse(this.props.cookies.cookies.userPresets):[];return r.a.createElement(B.a,{className:"PresetsManager"},r.a.createElement(I.a,null,this.props.presets.map((function(t,a){return r.a.createElement(D.a,{className:"preset",hidden:t.isHidden,onClick:function(){return e.onPresetClick(t)},key:"preset_"+a},t.title)}))),r.a.createElement(I.a,null,"Saved presets:"),r.a.createElement(I.a,null,t.map((function(t,a){return r.a.createElement(D.a,{className:"preset",onMouseEnter:function(t){return e.showEditBtn(t,a)},onMouseLeave:function(t){return e.hideEditBtn(t,a)},onClick:function(){return e.onPresetClick(t)},key:"preset_"+a},t.title,r.a.createElement("div",{className:"x",style:{visibility:e.state.showEdit[a]?"":"hidden"},onClick:function(t){return e.onPresetEdit(t,a)}},"Edit"))}))),r.a.createElement(I.a,null,r.a.createElement(Q,{ref:"presetEditor",onDeleteBtn:function(t){return e.onPresetDelete(t)},onSaveBtn:function(t,a){return e.onPresetEdit(t,a)},onSave:function(t,a){return e.onSavePreset(t,a)}})))}}]),t}(n.Component),ae=te;te.defaultProps={onSelect:function(e){}};var ne=function(e){function t(){return Object(c.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement(B.a,{className:"pane "+this.props.className},r.a.createElement(I.a,{className:"pane-title"},this.props.title),r.a.createElement(I.a,{className:"pane-body"},this.props.children))}}]),t}(n.Component),re=ne;ne.defaultProps={title:"title",children:[],className:""};var se=a(184),ie=a(185),oe={STOP:"stop",CYCLE:"cycle",REPEAT:"repeat",CONTINUE:"continue"},le=a(96),ce=a.n(le),ue=function(e){function t(e){var a;Object(c.a)(this,t),(a=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={value:void 0,regression:void 0};var n=[[0,a.props.min],[100,a.props.max]];return a.state.regression=ce.a.exponential(n,{precision:10}),a.prepareMarks(),a.state.value=a.props.defaultValue,a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"prepareMarks",value:function(){this.marks={};for(var e=0;e<this.props.marksAt.length;e++)this.marks[this.findX(this.props.marksAt[e])]=this.props.marksAt[e]}},{key:"makeMark",value:function(e){return{label:this.props.markFormatter(Math.floor(e)),style:this.props.marksStyle}}},{key:"onChange",value:function(e){var t=Math.floor(this.state.regression.predict(e)[1]);this.setState({value:t}),this.props.onChange(t)}},{key:"findX",value:function(e){return Math.log(e)/this.state.regression.equation[1]}},{key:"setValue",value:function(e){this.setState({value:e})}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement(O.a,{color:"light",onClick:this.onBadgeClick,className:"d-i"},this.props.badgeFormatter(this.state.value))),r.a.createElement(F.b,{ref:"slider",included:!1,value:this.findX(this.state.value),style:{height:"45px"},onChange:function(t){return e.onChange(t)},min:0,max:100,step:.5,marks:this.marks}))}}]),t}(n.Component),pe=ue;ue.defaultProps={marksNum:6,marksStyle:{color:"#ccc"},desc:"",badgeFormatter:function(e){return e},markFormatter:function(e){return e},defaultValue:50,marksAt:[]};var he=function(e){function t(){return Object(c.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement(O.a,{color:"light",className:"d-i"},this.state.bounds[0]," - ",this.state.bounds[1])),r.a.createElement("div",{style:{height:"30px"}},Object(x.a)(Object(h.a)(t.prototype),"render",this).call(this)))}}]),t}(F.a),me=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={playbackMode:oe.STOP,playMode:k.BY_TIME,bpmStep:10,bpmStepDropdownOpen:!1,byTimeInterval:5,byBarInterval:2,stableBpmSlider:300,bpmRange:[100,250]},a.onBpmSliderChange=function(e){a.setState({stableBpmSlider:e},a.props.onAfterChange)},a.state.playMode=e.playMode,e.playMode===k.BY_BAR?a.state.byBarInterval=e.interval:a.state.byTimeInterval=e.interval,a.state.bpmStep=e.bpmStep,a.state.bpmRange=e.bpmRange,a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"onModeChange",value:function(e){this.setState({playMode:e},this.props.onAfterChange)}},{key:"onBpmRangeChange",value:function(e){this.setState({bpmRange:e},this.props.onAfterChange)}},{key:"onBpmStepChange",value:function(){this.setState((function(e){return{bpmStepDropdownOpen:!e.bpmStepDropdownOpen}}))}},{key:"onBpmStepSelect",value:function(e){this.setState({bpmStep:e},this.props.onAfterChange)}},{key:"getValue",value:function(){return{playMode:this.state.playMode,playbackMode:this.state.playbackMode,interval:this.state.playMode===k.BY_BAR?this.state.byBarInterval:this.state.byTimeInterval,bpmStep:this.state.bpmStep,bpmRange:this.state.playMode!==k.STABLE?this.state.bpmRange:this.props.bpmRange,stableBpmSlider:this.state.stableBpmSlider}}},{key:"setValue",value:function(e){this.setState({playMode:e.playMode,playBackMode:e.playBackMode||this.state.playBackMode,bpmStep:e.bpmStep,byBarInterval:e.playMode===k.BY_BAR?e.interval:this.state.byBarInterval,byTimeInterval:e.playMode===k.BY_TIME?e.interval:this.state.byTimeInterval,bpmRange:e.bpmRange,stableBpmSlider:e.stableBpmSlider||this.state.stableBpmSlider},this.props.onAfterChange),(e.playMode===k.BY_BAR?this.refs.byBarSlider:this.refs.byTimeSlider).setValue(e.interval),this.refs.bpmRange.setState({bounds:e.bpmRange})}},{key:"onTimeIntervalChange",value:function(e){this.setState({byTimeInterval:e},this.props.onAfterChange)}},{key:"onBarIntervalChange",value:function(e){this.setState({byBarInterval:e},this.props.onAfterChange)}},{key:"byBarFormatter",value:function(e){var t=e+" ";return t+=1===e?"bar":"bars"}},{key:"byTimeFormatter",value:function(e){var t=M.formatTime(e)+" ";return t+=1===e?"second":e<60?"seconds":e<120?"minute":"minutes"}},{key:"onPlaybackChange",value:function(e){this.setState({playbackMode:e})}},{key:"renderIncreaseBpmDropdown",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,"increase speed by",r.a.createElement(R.a,{style:{margin:"0px 5px"},isOpen:this.state.bpmStepDropdownOpen,toggle:function(){return e.onBpmStepChange()}},r.a.createElement(N.a,{caret:!0,size:"sm",outline:!0,color:"light"},this.state.bpmStep),r.a.createElement(L.a,null,r.a.createElement(_.a,{onClick:function(){e.onBpmStepSelect(5)}},"5"),r.a.createElement(_.a,{onClick:function(){e.onBpmStepSelect(10)}},"10"),r.a.createElement(_.a,{onClick:function(){e.onBpmStepSelect(20)}},"20"),r.a.createElement(_.a,{onClick:function(){e.onBpmStepSelect(30)}},"30"),r.a.createElement(_.a,{onClick:function(){e.onBpmStepSelect(50)}},"50"))),"bpm")}},{key:"renderSpeedRange",value:function(){var e=this;return r.a.createElement("div",null,"Speed range",r.a.createElement(he,{ref:"bpmRange",min:30,max:600,defaultValue:[this.state.bpmRange[0],this.state.bpmRange[1]],pushable:!0,onAfterChange:function(t){return e.onBpmRangeChange(t)}}))}},{key:"render",value:function(){var e=this;return r.a.createElement(re,{className:"ModePanel",title:"Mode"},r.a.createElement(se.a,{size:"sm"},r.a.createElement(S.a,{size:"sm",outline:!0,color:"light",onClick:function(){return e.onModeChange(k.BY_BAR)},active:this.state.playMode===k.BY_BAR},"By bar"),r.a.createElement(S.a,{size:"sm",outline:!0,color:"light",onClick:function(){return e.onModeChange(k.BY_TIME)},active:this.state.playMode===k.BY_TIME},"By time"),r.a.createElement(S.a,{size:"sm",outline:!0,color:"light",onClick:function(){return e.onModeChange(k.STABLE)},active:this.state.playMode===k.STABLE},"Stable")),r.a.createElement(ie.a,{isOpen:this.state.playMode!==k.STABLE},this.renderSpeedRange()),r.a.createElement(ie.a,{isOpen:this.state.playMode===k.BY_BAR},r.a.createElement("div",null,"Increase speed every",r.a.createElement(pe,{ref:"byBarSlider",defaultValue:this.state.byBarInterval,badgeFormatter:this.byBarFormatter,onChange:function(t){return e.onBarIntervalChange(t)},min:1,max:301,marksAt:[1,2,5,10,20,50,100,300]}))),r.a.createElement(ie.a,{isOpen:this.state.playMode===k.BY_TIME},r.a.createElement("div",null,"Increase speed every",r.a.createElement(pe,{ref:"byTimeSlider",defaultValue:this.state.byTimeInterval,badgeFormatter:this.byTimeFormatter,markFormatter:M.formatTime,onChange:function(t){return e.onTimeIntervalChange(t)},min:1,max:600,marksAt:[1,2,5,10,30,60,120,240,600]}))),this.state.playMode!==k.STABLE?this.renderIncreaseBpmDropdown():"",r.a.createElement(ie.a,{isOpen:this.state.playMode===k.STABLE},r.a.createElement("div",null,"Choose bpm",r.a.createElement(Y,{ref:"stableBpmSlider",included:!1,min:10,max:600,marks:{30:"30",100:"100",200:"200",300:"300",400:"400",500:"500",600:"600"},value:this.state.stableBpmSlider,onChange:this.onBpmSliderChange}))),r.a.createElement(ie.a,{isOpen:this.state.playMode!==k.STABLE},r.a.createElement("div",null,"After plan"),r.a.createElement(se.a,{size:"sm"},r.a.createElement(S.a,{size:"sm",outline:!0,color:"light",onClick:function(){return e.onPlaybackChange(oe.STOP)},active:this.state.playbackMode===oe.STOP},"Stop"),r.a.createElement(S.a,{size:"sm",outline:!0,color:"light",onClick:function(){return e.onPlaybackChange(oe.CYCLE)},active:this.state.playbackMode===oe.CYCLE},"Cycle back"),r.a.createElement(S.a,{size:"sm",outline:!0,color:"light",onClick:function(){return e.onPlaybackChange(oe.CONTINUE)},active:this.state.playbackMode===oe.CONTINUE},"Last speed"),r.a.createElement(S.a,{size:"sm",outline:!0,color:"light",onClick:function(){return e.onPlaybackChange(oe.REPEAT)},active:this.state.playbackMode===oe.REPEAT},"Start over"))))}}]),t}(n.Component),fe=me;me.defaultProps={onAfterChange:null};var de=[{title:"4 beats every 4 bars",beatsPerStep:4,playMode:k.BY_BAR,interval:4,bpmStep:20,bpmRange:[100,400],accents:[0,1,2,1]},{title:"Jhaptal tabla",instrument:y.TABLA,beatsPerStep:10,bpmRange:[200,400],accents:[0,1,0,0,1,2,1,0,0,1],playMode:k.BY_TIME,interval:300,bpmStep:10},{title:"Balkan 1",bpmRange:[241,400],beatsPerStep:7,accents:[0,1,2,0,1,2,1],instrument:"electrokit",playMode:"by_bar",interval:20,bpmStep:30},{title:"Balkan 2",bpmRange:[293,400],beatsPerStep:7,accents:[0,1,2,0,1,2,1],instrument:"tabla",playMode:"by_bar",interval:300,bpmStep:50},{title:"Groove 1",bpmRange:[222,262],beatsPerStep:8,accents:[0,2,1,2,1,0,1,1],instrument:"electrokit",playMode:"by_time",interval:600,bpmStep:50},{title:"Groove 2",bpmRange:[222,400],beatsPerStep:8,accents:[0,2,0,2,2,2,0,1],instrument:"electrokit",playMode:"by_bar",interval:20,bpmStep:50}],be={title:"INIT",instrument:y.TABLA,beatsPerStep:4,bpmRange:[300,400],accents:[1,0,0,0],playMode:k.BY_TIME,playbackMode:oe.STOP,interval:10,bpmStep:50,isHidden:!0},ve=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(p.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={},a.width=300,a.height=200,a.values=[],a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"drawFFT",value:function(e){this.values=e,this.redraw()}},{key:"redraw",value:function(){this.ctx=this.refs.canvas.getContext("2d"),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.rect(0,0,this.width,this.height);var e=-1/0,t=1/0;if(this.values.length>0){var a=this.width/(this.values.length+2);this.ctx.lineWidth=a,this.ctx.lineCap="round";for(var n=0,r=this.values.length;n<r;n++){var s=(a+5)*n+a/2,i=(this.values[n]+140)/140*this.height;e=Math.max(e,this.values[n]),t=Math.min(t,this.values[n]),this.ctx.strokeStyle="rgba(255, 85, 85, "+(1-n/(r+10))+")",this.ctx.beginPath(),this.ctx.moveTo(s,this.height),this.ctx.lineTo(s,this.height-i),this.ctx.stroke()}}}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",(function(){return e.updateDimensions()})),this.updateDimensions(),this.redraw()}},{key:"updateDimensions",value:function(){var e=this.refs.container.clientWidth;this.refs.canvas.width=e,this.width=e,this.redraw()}},{key:"render",value:function(){return r.a.createElement("div",{ref:"container"},r.a.createElement("canvas",{ref:"canvas",height:"200"}))}}]),t}(n.Component),ge=a(72);function ye(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}ge.a.initialize("UA-151010848-1"),ge.a.pageview(window.location.pathname+window.location.search);var Ee=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(p.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={currentBpm:60,instrument:y.ELECTRO_KIT,instrumentDropdownOpen:!1,instrumentDropdownLabel:"Electro kit",cycleDropdownOpen:!1},a.playbackDirection=!0,a.onBeatsPerStepChange=function(){var e=a.getUiState().beatsPerStep;if(e!==a.refs.sm.beatsPerStep){for(var t=a.refs.barManager.getAccents();t.length>e;)t.pop();for(;t.length<e;)t.push(b.ACCENT_2);a.refs.sm.setBeatsPerStep(e),a.refs.barManager.setAccents(t),a.setState({beatsPerStep:e})}},a.setBpm=function(e){a.setState({currentBpm:e}),a.refs.sm.setBpm(e)},a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.refs.sm.setAccents(this.refs.barManager.getAccents()),document.addEventListener("keydown",(function(t){return e.handleKeyDown(t)})),this.refs.planner.setPlan(this.getUiState()),this.refs.sm.setVis(this.refs.vis)}},{key:"handleKeyDown",value:function(e){switch(e.keyCode){case 32:this.refs.sm.state.isPlaying?this.refs.planner.stepForward():this.refs.sm.handleStartStop();break;case 38:e.preventDefault(),this.state.currentBpm<600&&this.setBpm(this.state.currentBpm+10);break;case 40:e.preventDefault(),this.state.currentBpm>10&&this.setBpm(this.state.currentBpm-10);break;case 37:e.preventDefault(),this.refs.planner.stepBackward();break;case 39:e.preventDefault(),this.refs.planner.stepForward()}}},{key:"onInstrumentSelect",value:function(e){this.refs.sm.setInstrument(e);var t=this.refs.sm.getCurrentInstrumentLabel();this.setState({instrument:e,instrumentDropdownLabel:t},this.getUiState)}},{key:"renderInstrumentsDropDown",value:function(){var e=this;return r.a.createElement(R.a,{isOpen:this.state.instrumentDropdownOpen,toggle:function(){return e.onInstrumentChange()}},r.a.createElement(N.a,{caret:!0,size:"sm",outline:!0,color:"light"},this.state.instrumentDropdownLabel),r.a.createElement(L.a,null,r.a.createElement(_.a,{onClick:function(){e.onInstrumentSelect(y.TABLA)}},"Tabla"),r.a.createElement(_.a,{onClick:function(){e.onInstrumentSelect(y.ELECTRO_KIT)}},"Electro Kit"),r.a.createElement(_.a,{onClick:function(){e.onInstrumentSelect(y.METRONOME)}},"Metronome")))}},{key:"renderPlaybackPane",value:function(){var e=this;return r.a.createElement(B.a,{className:"pane"},r.a.createElement(I.a,{className:"pane-title"},"PLAYBACK"),r.a.createElement(I.a,null,r.a.createElement(D.a,{xs:"3"},"Instrument"),r.a.createElement(D.a,null,this.renderInstrumentsDropDown())),r.a.createElement(I.a,null,r.a.createElement(D.a,{xs:3},"Beats per step"),r.a.createElement(D.a,null,r.a.createElement(Y,{ref:"beatsPerStep",min:2,max:16,defaultValue:this.props.beatsPerStep,onAfterChange:function(){return e.onBeatsPerStepChange()}}))),r.a.createElement(I.a,null,r.a.createElement(D.a,{xs:3},"Accents"),r.a.createElement(D.a,null,r.a.createElement(z,{onAfterChange:function(){return e.onAccentsChange()},ref:"barManager",defaultValue:this.props.accents}))))}},{key:"onModePanelChanged",value:function(){var e=this.getUiState();this.refs.planner.setPlan(e)}},{key:"renderBottomPane",value:function(){return r.a.createElement(B.a,null,r.a.createElement(I.a,null,r.a.createElement(D.a,null,this.renderPresetsPane())),r.a.createElement(I.a,null,r.a.createElement(D.a,null,r.a.createElement(re,{title:"Keyboard controls",className:"about"},r.a.createElement("div",null,r.a.createElement("code",null,"up/down")," - adjust tempo"),r.a.createElement("div",null,r.a.createElement("code",null,"left/right")," - previous/next step according to plan"),r.a.createElement("div",null,r.a.createElement("code",null,"space")," - start/next step")))),r.a.createElement("div",{className:"footer"},r.a.createElement("div",null,"By using this site you agree to the use of cookies to store user defined presets."),r.a.createElement("div",null,"Created using React and ",r.a.createElement("a",{href:"https://tonejs.github.io/",rel:"noopener noreferrer",target:"_blank"},"Tone.js"),". Source code available ",r.a.createElement("a",{href:"https://github.com/indiebubbler/metro"},"here"),". ",r.a.createElement("br",null),"Contact dev at ",r.a.createElement("a",{href:"mailto:indiebubbler@gmail.com?subject=Feedback"},"indiebubbler@gmail.com"),".")))}},{key:"onProgress",value:function(e){this.refs.planner.setProgress(e)}},{key:"renderLeftPane",value:function(){var e=this;return r.a.createElement(B.a,null,r.a.createElement(I.a,null,r.a.createElement(D.a,null,r.a.createElement(re,{title:"Control"},r.a.createElement(P,{ref:"sm",beatsPerStep:this.state.beatsPerStep,onLoopEnd:function(){return e.onLoopEnd()},onBeat:function(t){return e.onBeat(t)},instrument:this.state.instrument,onProgress:function(t){return e.onProgress(t)}})))),r.a.createElement(I.a,null,r.a.createElement(D.a,null,r.a.createElement(fe,{ref:"modePanel",playMode:this.props.playMode,interval:this.props.interval,bpmStep:this.props.bpmStep,bpmRange:this.props.bpmRange,currentBpm:this.state.currentBpm,onAfterChange:function(){return e.onModePanelChanged()}}))),r.a.createElement(I.a,null,r.a.createElement(D.a,null,this.renderPlaybackPane())))}},{key:"renderPresetsPane",value:function(){var e=this;return r.a.createElement(B.a,{className:"pane"},r.a.createElement(I.a,{className:"pane-title"},"Presets"),r.a.createElement(ae,{ref:"presetsManager",cookies:this.props.cookies,presets:de,getPreset:function(){return e.getUiState()},onSelect:function(t){return e.onPresetSelect(t)}}))}},{key:"onPresetSelect",value:function(e){this.refs.beatsPerStep.setState({value:e.beatsPerStep}),this.refs.sm.setBeatsPerStep(e.beatsPerStep),this.onInstrumentSelect(e.instrument||y.TABLA),this.refs.barManager.setAccents(e.accents,e.beatsPerStep),this.refs.modePanel.setValue(e)}},{key:"renderRightPane",value:function(){var e=this;return r.a.createElement(B.a,null,r.a.createElement(I.a,null,r.a.createElement(D.a,null,r.a.createElement(re,{title:"Plan"},r.a.createElement(A,{currentBpm:this.state.currentBpm,onStep:function(t){return e.onPlanStep(t)},ref:"planner"})))),r.a.createElement(I.a,null,r.a.createElement(D.a,null,r.a.createElement(re,{title:"Visualisation"},r.a.createElement(ve,{ref:"vis"})))))}},{key:"onLoopEnd",value:function(){switch(this.refs.modePanel.state.playbackMode){case oe.CYCLE:(this.refs.planner.isLastStep()||this.refs.planner.isFirstStep())&&(this.playbackDirection=!this.playbackDirection),!0===this.playbackDirection?this.refs.planner.stepForward():this.refs.planner.stepBackward();break;case oe.REPEAT:this.refs.planner.isLastStep()?this.refs.planner.setStep(0):this.refs.planner.stepForward();break;case oe.CONTINUE:if(this.refs.planner.isLastStep()){var e=this.refs.modePanel.getValue();e.playMode=k.STABLE,e.stableBpmSlider=this.state.currentBpm,this.refs.modePanel.setValue(e)}else this.refs.planner.stepForward();break;case oe.STOP:this.refs.planner.isLastStep()?this.refs.sm.handleStartStop():this.refs.planner.stepForward();break;default:this.refs.planner.stepForward()}}},{key:"onBeat",value:function(e){this.refs.barManager.setActive(e)}},{key:"render",value:function(){return document.title="BPM: "+this.state.currentBpm.toFixed(0)+" | SpeedTrainer",r.a.createElement("div",{className:"App"},r.a.createElement(B.a,{className:"app-container"},r.a.createElement(I.a,null,r.a.createElement(D.a,null,this.renderLeftPane()),r.a.createElement(D.a,null,this.renderRightPane())),r.a.createElement(I.a,null,r.a.createElement(D.a,null,this.renderBottomPane()))))}},{key:"onPlanStep",value:function(e){e&&this.setState({currentBpm:this.refs.sm.setStep(e)})}},{key:"onInstrumentChange",value:function(){this.setState((function(e){return{instrumentDropdownOpen:!e.instrumentDropdownOpen}}))}},{key:"getUiState",value:function(){var e=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ye(a,!0).forEach((function(t){Object(l.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ye(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},{beatsPerStep:this.refs.beatsPerStep.getValue(),accents:this.refs.barManager.getAccents(),instrument:this.state.instrument},{},this.refs.modePanel.getValue());return this.uiState=e,this.uiState.instrument=this.state.instrument,e}},{key:"onAccentsChange",value:function(){this.refs.sm.setAccents(this.refs.barManager.getAccents())}}]),t}(n.Component),Se=Object(o.b)(Ee);Ee.defaultProps={playbackMode:be.playbackMode,playMode:be.playMode,interval:be.interval,instrument:be.instrument,bpmStep:be.bpmStep,bpmRange:be.bpmRange,beatsPerStep:be.beatsPerStep,accents:be.accents};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(o.a,null," ",r.a.createElement(Se,null)," "),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},98:function(e,t,a){e.exports=a(172)}},[[98,1,2]]]);
//# sourceMappingURL=main.b5f5436c.chunk.js.map