(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t,a){},169:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),s=a(8),i=a.n(s),c=(a(97),a(15)),l=a(20),o=a(16),u=a(13),m=a(17),h=a(32),p=(a(100),a(19)),f=a.n(p),g=function(e){function t(e){Object(c.a)(this,t);var a={C3:e.accent,C4:e.tick};return Object(o.a)(this,Object(u.a)(t).call(this,a,{baseUrl:"./audio/"}))}return Object(m.a)(t,e),t}(p.Sampler),d=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(o.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).instrumentTypes={TABLA:"tabla",ELECTRO:"electro",SYNTH:"synth"},a.tickNote="C4",a.accentNote="C3",a.state={instrument:a.instrumentTypes.TABLA,measuresPerBar:3,isPlaying:!1},a.samples={},a.instruments={},a.accents=[0],a.part=null,a.setBpm=function(e){f.a.Transport.bpm.value=e},a.setMeasuresPerBar=function(e){a.setState({measuresPerBar:e},function(){a.restart()})},a.restart=function(){var e=a.instruments[a.state.instrument];a.part&&(a.part.stop(),a.part.removeAll(),a.part=void 0);for(var t=[],n=0;n<a.state.measuresPerBar;n++)t.push(["0:"+n,a.accents.indexOf(n)<0?a.tickNote:a.accentNote]);a.part=new f.a.Part(function(t,a){e.triggerAttackRelease(a,"4n",t)},t),f.a.Transport.timeSignature=[a.state.measuresPerBar,4],a.part.loopEnd="1m",a.part.loop=!0,a.part.start()},a.getBpm=function(){return f.a.Transport.bpm.value},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){(new f.a.Synth).toMaster().triggerAttackRelease("A2"),f.a.Buffer.on("load",this.restart);var e=new g({key:"tabla",accent:"Tha.wav",tick:"Tin.wav"}).toMaster();this.instruments[this.instrumentTypes.TABLA]=e;var t=new g({key:"electro",accent:"electronicHat.wav",tick:"electronicKick.mp3"}).toMaster();this.instruments[this.instrumentTypes.ELECTRO]=t,f.a.context.latencyHint="playback"}},{key:"setInstrument",value:function(e){this.setState({instrument:e},this.restart)}},{key:"setAccents",value:function(e){this.accents=e;for(var t=0;t<this.part.length;t++)this.part.at("0:"+t,this.accents.indexOf(t)<0?this.tickNote:this.accentNote)}},{key:"render",value:function(){return r.a.createElement("div",null,"Sound is ",!0===this.state.isPlaying?"playing":"stopped")}},{key:"toggle",value:function(){"started"===f.a.Transport.state?(this.setState({isPlaying:!1}),f.a.Transport.stop()):(this.setState({isPlaying:!0}),f.a.Transport.start("+0.05"))}}]),t}(n.Component),b=a(178),v=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return(a=Object(o.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={currentStep:0,bars:[]},a.stepsCounter=0,a.planChanged=function(){a.props.onChange&&(console.log("<Planner>onChange"),a.props.onChange())},a.barRender=function(e){var t="badge badge-pill badge-"+(a.state.currentStep===e.step?"primary":"secondary");return r.a.createElement("code",{className:t,key:"key_"+e.bpm},e.formattedTime," -- ",e.bpm.toFixed(2))},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"setPlan",value:function(e){for(var t=[],a=0;a<e.length;a++){var n=e[a].time,r=e[a].bpm,s={time:n,formattedTime:this.formatTime(n),bpm:r,step:this.stepsCounter++};t.push(s)}this.stepsCounter=0,this.setState(function(e){return{currentStep:0,bars:t}}),this.planChanged()}},{key:"clear",value:function(){this.stepsCounter=0,this.setState({bars:[],currentStep:0}),this.planChanged()}},{key:"resetStep",value:function(){this.setState({currentStep:0})}},{key:"advanceStep",value:function(){var e=this.state.currentStep;return e+1>=this.state.bars.length?null:(this.setState({currentStep:e+1}),this.state.currentStep)}},{key:"getCurrentBar",value:function(){if(this.state.getCurrentStep>=this.state.bars.length)throw new Error("we are fcked");return this.state.bars[this.state.currentStep]}},{key:"padTime",value:function(e){return e<10?"0"+e:e}},{key:"formatTime",value:function(e){var t=new Date(0,0,0,0,0,0,0);return t.setSeconds(e),this.padTime(t.getMinutes())+":"+this.padTime(t.getSeconds())}},{key:"render",value:function(){var e=this;return console.log("<Planner> render"),0===this.state.bars.length?r.a.createElement(b.a,{variant:"warning"},"No plan"):r.a.createElement(b.a,{variant:"success"},r.a.createElement("div",{style:{fontSize:"0.5rem"}},this.state.bars.map(function(t){return e.barRender(t)})))}}]),t}(n.Component),y=(a(111),a(113),a(168)),E=a(172),B=a(173),k=a(174),C=a(170),S=a(179),O=a(175),j=a(176),D=a(177),T=a(49),w=a(48),x=function(e){function t(){return Object(c.a)(this,t),Object(o.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,Object(T.a)(Object(u.a)(t.prototype),"render",this).call(this),r.a.createElement("div",null,r.a.createElement(C.a,{onClick:this.onBadgeClick,className:"d-i"},this.state.value)))}},{key:"onBadgeClick",value:function(){}}]),t}(w.b),N=function(e){function t(){return Object(c.a)(this,t),Object(o.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,Object(T.a)(Object(u.a)(t.prototype),"render",this).call(this),r.a.createElement(C.a,{onClick:this.onBadgeClick,className:"d-i"},this.state.bounds[0]," - ",this.state.bounds[1]))}}]),t}(w.a),P=a(69),A=a(171),R=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).state={bars:[],accentBars:[0]},a.renderCells=function(e){return e.map(function(e){return r.a.createElement(y.a,{color:"primary",key:e,onClick:function(){return a.handleCellClick(e)},active:!a.state.accentBars.includes(e)},e+1)})},a.state.bars=a.prepareBars(e.defaultValue),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"prepareBars",value:function(e){for(var t=[],a=0;a<e;a++)t.push(a);return t}},{key:"setBarsAmount",value:function(e){var t=this.prepareBars(e);this.setState({bars:Object(P.a)(t)})}},{key:"handleCellClick",value:function(e){var t=this.state.accentBars.indexOf(e);t<0?this.state.accentBars.push(e):this.state.accentBars.splice(t,1),this.setState({accentBars:Object(P.a)(this.state.accentBars)})}},{key:"getAccentBars",value:function(){return this.state.accentBars}},{key:"render",value:function(){var e=this.props.onAfterChange;return r.a.createElement(A.a,{onClick:e},this.renderCells(this.state.bars))}}]),t}(n.Component),M="tabla",V="electro",I=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(o.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).timer={timerRef:null,startTime:null},a.lockType={SEGMENT:"segment",STEP:"step"},a.uiElements={segmentDuration:"segment_duration",exerciseDuration:"exercise_duration",totalBars:"total_bars"},a.state={bpmRange:[200,300],exerciseDuration:120,segmentDuration:5,totalBars:24,measuresPerBar:4,currentBpm:100,instrument:"tabla",instrumentDropdownOpen:!1},a.onPlanChanged=function(){if(!1!==a.refs.sm.state.isPlaying){console.log("planner onPlanChanged");var e=a.setNewSpeed.bind(Object(h.a)(Object(h.a)(a)));console.log("scheduling newSpeed each ",a.refs.segmentDuration.getValue(),"seconds"),a.startTimer(1e3*a.refs.segmentDuration.getValue(),e)}},a.handleStartStop=function(){if(a.refs.sm.toggle(),"started"!==a.refs.sm.state&&a.timer.ref)console.log("plan execution cancelled"),clearInterval(a.timer.ref),a.timer.ref=void 0,a.refs.planner.resetStep();else{var e=a.setNewSpeed.bind(Object(h.a)(Object(h.a)(a)));console.log("scheduling newSpeed each ",a.refs.segmentDuration.getValue(),"seconds"),a.startTimer(1e3*a.refs.segmentDuration.getValue(),e)}},a.setNewSpeed=function(){var e=a.refs.planner;if(e.advanceStep()){var t=e.getCurrentBar().bpm;a.setState({currentBpm:t}),a.refs.sm.setBpm(t)}else a.handleStartStop()},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.settingsChanged()}},{key:"onInstrumentSelect",value:function(e){this.refs.sm.setInstrument(e),this.setState({instrument:e})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"App"},r.a.createElement(d,{ref:"sm"}),r.a.createElement(y.a,{onClick:function(){return e.handleStartStop()}},"Start / Stop"),r.a.createElement(E.a,null,r.a.createElement(B.a,null,r.a.createElement(k.a,null,r.a.createElement(E.a,null,r.a.createElement(B.a,{className:"p-2"},r.a.createElement(k.a,{xs:5,className:"badge badge-primary "},"BPM Range"),r.a.createElement(k.a,null,r.a.createElement(N,{ref:"bpmRange",min:30,max:400,defaultValue:[this.state.bpmRange[0],this.state.bpmRange[1]],pushable:!0,onAfterChange:function(){return e.settingsChanged()}}))),r.a.createElement(B.a,{className:"p-2"},r.a.createElement(k.a,{xs:5,className:"badge badge-primary"},"Segment Duration(s)"),r.a.createElement(k.a,null,r.a.createElement(x,{ref:"segmentDuration",min:1,max:120,defaultValue:this.state.segmentDuration,onAfterChange:function(){return e.segmentDurationChanged()}}))),r.a.createElement(B.a,{className:"p-2"},r.a.createElement(k.a,{xs:5,className:"badge badge-primary"},"Total time(min)"),r.a.createElement(k.a,null,r.a.createElement(x,{ref:"exerciseDuration",min:1,max:30,defaultValue:this.state.exerciseDuration/60,onAfterChange:function(){return e.settingsChanged(e.uiElements.exerciseDuration)}}))),r.a.createElement(B.a,{className:"p-2"},r.a.createElement(k.a,{xs:5,className:"badge badge-primary"},"Bars"),r.a.createElement(k.a,null,r.a.createElement(x,{ref:"totalBars",min:1,max:50,defaultValue:this.state.totalBars,onAfterChange:function(){return e.settingsChanged(e.uiElements.totalBars)}}))),r.a.createElement(B.a,{className:"p-2"},r.a.createElement(k.a,{xs:5,className:"badge badge-primary"},"Measures per Bar"),r.a.createElement(k.a,null,r.a.createElement(x,{ref:"measuresPerBar",min:2,max:16,defaultValue:this.state.measuresPerBar,onAfterChange:function(){return e.settingsChanged()}}))),r.a.createElement(B.a,{className:"p-2"},r.a.createElement(k.a,{xs:5,className:"badge badge-primary"},"Bar Manager"),r.a.createElement(k.a,null,r.a.createElement(R,{onAfterChange:function(){return e.onAccentsChange()},ref:"barManager",defaultValue:this.state.measuresPerBar}))),r.a.createElement(B.a,{className:"p-2"},r.a.createElement(k.a,{xs:5,className:"badge badge-primary"},"Instrument"),r.a.createElement(k.a,null,r.a.createElement(S.a,{isOpen:this.state.instrumentDropdownOpen,toggle:function(){return e.onInstrumentChange()}},r.a.createElement(O.a,{caret:!0},this.state.instrument),r.a.createElement(j.a,null,r.a.createElement(D.a,{onClick:function(){e.onInstrumentSelect(M)}},"Tabla"),r.a.createElement(D.a,{onClick:function(){e.onInstrumentSelect(V)}},"Electro"))))))),r.a.createElement(k.a,{xs:3},r.a.createElement(C.a,{color:"info"},"Current BPM:",r.a.createElement("span",{ref:"currentBpmBadge"},this.state.currentBpm.toFixed(0))),r.a.createElement(v,{lockTo:this.state.lockTo,onChange:function(){return e.onPlanChanged()},ref:"planner"})))))}},{key:"onInstrumentChange",value:function(){this.setState(function(e){return{instrumentDropdownOpen:!e.instrumentDropdownOpen}})}},{key:"getUiState",value:function(){return{currentBpm:this.refs.sm.getBpm(),bpmRange:this.refs.bpmRange.getValue(),segmentDuration:this.refs.segmentDuration.getValue(),exerciseDuration:this.refs.exerciseDuration.getValue(),totalBars:this.refs.totalBars.getValue(),measuresPerBar:this.refs.measuresPerBar.getValue()}}},{key:"onAccentsChange",value:function(){var e=this.refs.barManager.getAccentBars();this.refs.sm.setAccents(e)}},{key:"segmentDurationChanged",value:function(){console.log("segmentDurationChanged");var e=this.getUiState(),t=e.segmentDuration,a=Math.floor(60*e.exerciseDuration/e.segmentDuration);this.refs.totalBars.setState({value:a});for(var n=e.bpmRange[0],r=(e.bpmRange[1]-n)/a,s=this.refs.planner,i=[],c=0;c<=a;c++)i.push({time:c*t,bpm:n+c*r});s.setPlan(i),this.refs.sm.setBpm(e.bpmRange[0])}},{key:"settingsChanged",value:function(e){var t=this.getUiState(),a=t.segmentDuration,n=60*t.exerciseDuration,r=t.totalBars,s=t.measuresPerBar;e===this.uiElements.segmentDuration&&(r=Math.floor(60*t.exerciseDuration/t.segmentDuration),this.refs.totalBars.setState({value:r})),e!==this.uiElements.totalBars&&e!==this.uiElements.exerciseDuration||(a=Math.floor(60*t.exerciseDuration/t.totalBars),this.refs.segmentDuration.setState({value:a})),this.segmentDurationChanged(),this.setState({currentBpm:t.bpmRange[0],bpmRange:t.bpmRange,exerciseDuration:n,segmentDuration:a,totalBars:r,measuresPerBar:s}),this.refs.sm.setMeasuresPerBar(s),this.refs.sm.setBpm(t.bpmRange[0]),this.refs.barManager.setBarsAmount(s)}},{key:"startTimer",value:function(e,t){console.log("startTimer()"),this.timer.ref&&(console.log("startTimer() old timer disposed"),clearInterval(this.timer.ref),this.timer.ref=void 0,this.timer.startTime=null,this.refs.planner.resetStep()),this.timer={ref:setInterval(t,e),startTime:new Date}}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(I,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},92:function(e,t,a){e.exports=a(169)},97:function(e,t,a){}},[[92,2,1]]]);
//# sourceMappingURL=main.791eb96a.chunk.js.map