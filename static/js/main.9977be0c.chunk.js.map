{"version":3,"sources":["components/AccentTypes.jsx","components/SoundMachineInstrument.jsx","components/InstrumentLib.jsx","components/PlayModes.jsx","components/Vis.jsx","components/SoundMachine.jsx","components/SimpleProgress.jsx","components/Utils.jsx","components/Planner.jsx","components/AdvancedSlider.jsx","components/Accent.jsx","components/BarManager.jsx","components/EditPresetModal.jsx","components/PresetsManager.jsx","components/SimplePanel.jsx","components/PlaybackModes.jsx","components/GeometricSlider.jsx","components/AdvancedRange.jsx","components/ModePanel.jsx","components/PresetsLib.jsx","App.jsx","serviceWorker.js","index.js"],"names":["accentTypes","ACCENT_1","ACCENT_2","ACCENT_3","accentTypesArr","SoundMachineInstrument","props","_this","Object","classCallCheck","this","o","C3","samples","C#3","D3","possibleConstructorReturn","getPrototypeOf","call","baseUrl","key","label","Sampler","instruments","TABLA","ELECTRO_KIT","METRONOME","InstrumentLib","defaultInstrument","state","lib","currentInstrument","undefined","fft","tabla","electro","metronome","setInstrument","Tone","FFT","fan","toMaster","Error","Component","playModes","BY_BAR","BY_TIME","STABLE","Vis","width","height","values","redraw","ctx","refs","canvas","getContext","clearRect","rect","max","Infinity","min","length","barWidth","lineWidth","lineCap","i","len","x","h","Math","strokeStyle","beginPath","moveTo","lineTo","stroke","_this2","window","addEventListener","updateDimensions","clientWidth","container","react_default","a","createElement","ref","SoundMachine","accentNotes","instrumentLib","currentBeat","beatsPerStep","progressRefreshRate","score","isPlaying","accents","executeStep","step","lastStep","currentStep","getBpm","bpm","setBpm","newLE","playMode","duration","Transport","setLoopPoints","lastLoopDuration","start","repeat","time","idx","note","getInstrument","triggerAttack","Draw","schedule","onBeat","isNaN","value","loopEnd","setBeatsPerStep","newBps","pop","push","timeSignature","loop","setState","handleStartStop","stop","instrument","onToggle","clearInterval","stepProgressUpdateTimer","setInterval","updateProgress","_this3","Synth","triggerAttackRelease","Buffer","on","onBufferError","onStop","onStart","onLoopEnd","context","latencyHint","Loop","onProgress","progress","vis","drawFFT","getValue","instrumentKey","_this4","Button","outline","color","onClick","block","active","defaultProps","SimpleProgress","Container","className","style","display","Utils","padTime","t","formatTime","timeInSeconds","Date","setSeconds","getMinutes","getSeconds","Planner","bars","stepProgress","isPaused","timer","startTime","stepsCounter","barRender","b","cls","setStep","segmentDuration","toFixed","end","s","segments","bpmRange","segment","interval","bpmStep","stableBpmSlider","uiStateObject","plan","makePlan","totalPlanTime","bar","timeEnd","startTimeFormatted","endTimeFormatted","console","log","prevState","stepChanged","pause","resetStep","stepIdx","getCurrentStep","onStep","date","Badge","currentBpm","components_SimpleProgress","lockBpm","opacity","map","AdvancedSlider","Fragment","get","prototype","Slider","Accent","isCurrent","type","BarManager","defaultValue","onAfterChange","selected","newBars","toConsumableArray","lastActiveAccent","toggleCurrent","el","components_Accent","handleCellClick","EditPresetModal","modal","preset","showDelete","toggle","bind","assertThisInitialized","title","onSave","e","newTitle","target","objectSpread","onDeleteBtn","size","onSaveBtn","Modal","isOpen","ModalHeader","ModalBody","Input","onChange","titleChanged","JSON","stringify","ModalFooter","handleSave","renderDelete","PresetsManager","showEdit","userPresets","cookies","Array","fill","onSelect","toLowerCase","saveInCookie","presets","set","path","indexOf","splice","stopPropagation","presetEditor","edit","p","getPreset","parse","Row","item","Col","hidden","isHidden","onPresetClick","onMouseEnter","showEditBtn","onMouseLeave","hideEditBtn","class","visibility","onPresetEdit","components_EditPresetModal","onPresetDelete","onSavePreset","SimplePanel","children","playbackModes","STOP","CYCLE","REPEAT","CONTINUE","GeometricSlider","regression","d","exponential","precision","string","prepareMarks","marks","marksAt","findX","markFormatter","floor","marksStyle","v","predict","y","equation","onBadgeClick","badgeFormatter","es","included","marksNum","desc","AdvancedRange","bounds","Range","ModePanel","playbackMode","bpmStepDropdownOpen","byTimeInterval","byBarInterval","onBpmSliderChange","newMode","playBackMode","byBarSlider","byTimeSlider","setValue","barsNum","newPlaybackMode","ButtonDropdown","margin","onBpmStepChange","DropdownToggle","caret","DropdownMenu","DropdownItem","onBpmStepSelect","components_AdvancedRange","pushable","onBpmRangeChange","components_SimplePanel","ButtonGroup","onModeChange","Collapse","renderSpeedRange","components_GeometricSlider","byBarFormatter","onBarIntervalChange","byTimeFormatter","onTimeIntervalChange","renderIncreaseBpmDropdown","components_AdvancedSlider","30","100","200","300","400","500","600","onPlaybackChange","PresetsLib","InitPreset","App","instrumentDropdownOpen","instrumentDropdownLabel","cycleDropdownOpen","playbackDirection","onBeatsPerStepChange","getUiState","sm","barManager","getAccents","setAccents","newBpm","document","handleKeyDown","planner","setPlan","setVis","keyCode","stepForward","preventDefault","stepBackward","newInstrument","getCurrentInstrumentLabel","onInstrumentChange","onInstrumentSelect","xs","renderInstrumentsDropDown","components_BarManager","onAccentsChange","renderPresetsPane","setProgress","_this5","components_SoundMachine","beat","components_ModePanel","onModePanelChanged","renderPlaybackPane","_this6","components_PresetsManager","onPresetSelect","modePanel","_this7","components_Planner","onPlanStep","components_Vis","isLastStep","isFirstStep","currentMode","setActive","renderLeftPane","renderMidPane","renderRightPane","s1","s2","uiState","withCookies","Boolean","location","hostname","match","ReactDOM","render","es6","src_App_0","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.9977be0c.chunk.js","sourcesContent":["export const accentTypes = {\r\n\tACCENT_1: 0,\r\n\tACCENT_2: 1,\r\n\tACCENT_3: 2\r\n};\r\n\r\nexport const accentTypesArr = [\r\n\taccentTypes.ACCENT_1, accentTypes.ACCENT_2, accentTypes.ACCENT_3\r\n];","import {Sampler} from 'tone'\r\n\r\n\r\nclass SoundMachineInstrument extends Sampler {\r\n\r\n    constructor(props) {\r\n        // console.log('<SoundMachineInstrument>constructor', props.key)\r\n        var o = {\r\n            \"C3\" : props.samples[0],\r\n            \"C#3\" : props.samples[1],\r\n            \"D3\" : props.samples[2],\r\n        };\r\n        super(o,{\r\n            baseUrl: props.baseUrl || './audio/' + props.key + '/'\r\n        });\r\n        this.key = props.key;\r\n        this.label = props.label;\r\n    }\r\n}\r\n\r\nexport default SoundMachineInstrument;\r\n\r\n ","import { Component } from \"react\";\r\nimport SoundMachineInstrument from \"./SoundMachineInstrument\"\r\nimport Tone from 'tone'\r\nexport const instruments = {\r\n\tTABLA: \"tabla\",\r\n    ELECTRO_KIT: \"electrokit\",\r\n    METRONOME: \"metronome\"\t// ACOUSTIC_KIT: \"acoustic_kit\"\r\n};\r\n\r\nclass InstrumentLib extends Component {\r\n\tstate = {};\r\n    lib = {};\r\n    currentInstrument = undefined\r\n    fft = undefined\r\n\r\n\r\n    constructor(defaultInstrument) {\r\n        super();\r\n    \r\n        //Tone.Buffer.on(\"load\", () => this.onBufferLoaded());\r\n\t\tvar tabla = new SoundMachineInstrument({\r\n            key: instruments.TABLA,\r\n            label: \"Tabla\",\r\n\t\t\tsamples: [\"dha-slide.wav\", \"dhin-slide.wav\", \"tin.wav\"]\r\n        });\r\n        this.lib[ tabla.key ] = tabla;\r\n    \r\n        var electro = new SoundMachineInstrument({\r\n            key: instruments.ELECTRO_KIT,\r\n            label: 'Electronic Kit',\r\n\t\t\tsamples: [\"Kick.wav\", \"HiHat.wav\", \"Snare.wav\"]\r\n        });\r\n        this.lib[ electro.key ] = electro;\r\n\r\n        var metronome = new SoundMachineInstrument({\r\n            key: instruments.METRONOME,\r\n            label: \"Metronome\",\r\n            samples: [\"tap.wav\", \"down.wav\",\"up.wav\"]\r\n        })\r\n\r\n        this.lib[ metronome.key ] = metronome;\r\n        \r\n\r\n        this.setInstrument(defaultInstrument)\r\n        \r\n        // console.log('<InstrumentLib>done constructor')\r\n\r\n        this.fft = new Tone.FFT(128);\r\n        \r\n        // connect instruments to FFT analyzer\r\n        electro.fan(this.fft).toMaster();\r\n        tabla.fan(this.fft).toMaster();\r\n        metronome.fan(this.fft).toMaster();\r\n    }\r\n\r\n    setInstrument(key) {\r\n        if (this.lib[key] === undefined) {\r\n            throw new Error(\"InstrumentLib has no such instrument with given key: \" + key)\r\n        }\r\n        this.currentInstrument = key;\r\n    }\r\n \r\n    getInstrument() {\r\n        if (this.lib[this.currentInstrument] === undefined) {\r\n            throw new Error(\"There is no such instrument in InstrumentLib: \" + this.currentInstrument)\r\n        }\r\n        return this.lib[this.currentInstrument];\r\n    }\r\n\r\n\t// render() {\r\n\t// \treturn <div />;\r\n\t// }\r\n}\r\nexport default InstrumentLib;\r\n","export const playModes = {\r\n\tBY_BAR: \"by_bar\",\r\n\tBY_TIME: \"by_time\",\r\n\tSTABLE: \"stable\"\r\n};","import React, { Component } from 'react';\r\n\r\nclass Vis extends Component {\r\n    state = {}\r\n    ctx;\r\n    width = 300;\r\n    height = 200;\r\n    values = [];\r\n\r\n    drawFFT(values) {\r\n        this.values = values;\r\n        this.redraw();\r\n    }\r\n\r\n    redraw() {\r\n        this.ctx = this.refs.canvas.getContext(\"2d\");\r\n        \r\n        // this.ctx.clearRect(0, 0,this.width,this.height);\r\n        // console.log('<Vis>redraw', this.width, this.height)\r\n        this.ctx.clearRect(0,0,this.width, this.height)\r\n        this.ctx.rect(0, 0, this.width, this.height);\r\n        // this.ctx.stroke();\r\n        \r\n        var max = -Infinity;\r\n        var min = Infinity;\r\n\r\n        if (this.values.length > 0) {\r\n            \r\n            const barWidth = this.width / (this.values.length+2);\r\n\r\n            // this.values store decibels for each freq in range [-140,0]\r\n            this.ctx.lineWidth = barWidth;\r\n            this.ctx.lineCap = \"round\";\r\n            for (let i = 0, len = this.values.length; i < len ; i++) {\r\n                // debugger\r\n                var x = (barWidth + 5)* i + barWidth / 2 ;\r\n                \r\n                var h = ((this.values[i] + 140) / 140) * this.height;\r\n\r\n\r\n                max = Math.max(max, this.values[i])\r\n                min = Math.min(min, this.values[i])\r\n                // this.ctx.fillStyle = \"rgba(255, 85, 85, \"+ (1 - i/(len+10)) + \")\";\r\n                // this.ctx.fillRect(x, this.height, barWidth, -h);\r\n                this.ctx.strokeStyle = \"rgba(255, 85, 85, \"+ (1 - i/(len+10)) + \")\";\r\n                this.ctx.beginPath();\r\n                this.ctx.moveTo(x, this.height );\r\n                this.ctx.lineTo(x, this.height - h);\r\n                // this.ctx.lineTo(70, 100);\r\n                \r\n                this.ctx.stroke();\r\n                \r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    // drawBar(val) {\r\n    //     // if (val > 0) {\r\n    //         console.log('val',val)\r\n    //     // }\r\n    //     // this.ctx.clearRect(0, 0, this.width, this., canvasHeight);\r\n    //     var barWidth = this.width / val.size;\r\n    //     debugger\r\n    //     for (var i = 0, len = values.length; i < len; i++){\r\n    //         var x = canvasWidth * (i / len);\r\n    //         var y = (values[i] + 140) * 2;\r\n    //         fftContext.fillStyle = \"rgba(0, 0, 0, \" + i/len + \")\";\r\n    //         fftContext.fillRect(x, canvasHeight - y, barWidth, canvasHeight);\r\n    //     }\r\n    // }\r\n\r\n    componentDidMount() {\r\n        window.addEventListener(\"resize\", () => this.updateDimensions());\r\n        this.updateDimensions()\r\n        this.redraw();\r\n    }\r\n\r\n    updateDimensions() {\r\n        let { clientWidth } = this.refs.container;\r\n        \r\n        this.refs.canvas.width = clientWidth;\r\n        // this.refs.canvas.height = clientHeight\r\n\r\n        this.width = clientWidth;\r\n        // this.height = clientHeight;\r\n \r\n        this.redraw();\r\n    }\r\n\r\n    render() {\r\n        return (\r\n                <div ref=\"container\">\r\n                    <canvas ref='canvas' height=\"200\"/>\r\n                </div>\r\n            \r\n        );\r\n    }\r\n}\r\n\r\nexport default Vis;","import React, { Component } from \"react\";\r\nimport Tone from \"tone\";\r\nimport { accentTypes } from \"./AccentTypes\";\r\nimport InstrumentLib from \"./InstrumentLib\";\r\nimport { Button } from 'reactstrap'\r\nimport { playModes } from \"./PlayModes\";\r\nimport Vis from \"./Vis\"\r\nclass SoundMachine extends Component {\r\n\r\n\taccentNotes = [\"C3\", \"C#3\", \"D3\"]; // this stay in sync with AccentTypes\r\n\r\n\tinstrumentLib = undefined;\r\n\r\n\tcurrentBeat = 0;\r\n\tbeatsPerStep = 4;\r\n\r\n\tprogressRefreshRate = 1000 / 60; // fps\r\n\r\n\tscore = [\"C3\", \"C#3\", \"C#3\", \"C#3\"];\r\n\r\n\tstate = {\r\n\t\tisPlaying: false\r\n\t};\r\n\r\n\taccents = [accentTypes.ACCENT_1]; // default with accent on first beat\r\n\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\t// init instruments library\r\n\t\tthis.instrumentLib = new InstrumentLib(this.props.instrument)\r\n\t}\r\n\r\n\tonBufferError() {\r\n\t\tthrow new Error(\"Some buffers weren't found\")\r\n\t}\r\n\r\n\tonStop() {\r\n\t\t// console.log('onStop')\r\n\t\tthis.props.onToggle(this.state.isPlaying)\r\n\r\n\t\tclearInterval(this.stepProgressUpdateTimer);\r\n\t}\r\n\r\n\tonStart() {\r\n\t\tthis.props.onToggle(this.state.isPlaying)\r\n\r\n\t\tthis.stepProgressUpdateTimer = setInterval(\r\n\t\t\t() => this.updateProgress(),\r\n\t\t\tthis.progressRefreshRate\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\t// reload/debug bell\r\n\t\tvar synth = new Tone.Synth().toMaster();\r\n\t\tsynth.triggerAttackRelease(\"A2\");\r\n\r\n\t\tTone.Buffer.on(\"error\", () => this.onBufferError());\r\n\r\n\t\tTone.Transport.on('stop', () => this.onStop());\r\n\t\tTone.Transport.on('start', () => this.onStart());\r\n\t\t// Tone.Transport.on('pause', () => console.log('TRANSPORT.pause'));\r\n\t\t// Tone.Transport.on('start', () => console.log('TRANSPORT.start'));\r\n\t\tTone.Transport.on('loop', (time) => this.props.onLoopEnd(time));\r\n\r\n\t\tTone.context.latencyHint = \"playback\";\r\n\r\n\t\tTone.Transport.timeSignature = 4;// [this.beatsPerStep, 4];\r\n\r\n\t\tTone.Transport.loop = true;\r\n\t\tTone.Transport.loopEnd = \"1m\"\r\n\r\n\t\tthis.loop = new Tone.Loop((time) => this.repeat(time), \"4n\");\r\n\t\tthis.loop.start()\r\n\t\t// console.log('Transport loopEnd set to', Tone.Transport.loopEnd)\r\n\r\n\t\t//Tone.Transport.scheduleRepeat((time) => this.repeat(time), \"4n\");\r\n\r\n\r\n\t}\r\n\r\n\tupdateProgress() {\r\n\t\tthis.props.onProgress(Tone.Transport.progress);\r\n\r\n\t\tif (this.vis) {\r\n\t\t\tthis.vis.drawFFT(this.instrumentLib.fft.getValue())\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tsetStep(step) {\r\n\t\t// console.log(\"<SM>store step:\", step)\r\n\r\n\t\tif (step === this.currentStep) {\r\n\t\t\t// console.log('step didnt changed so continue only')\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.currentStep = step;\r\n\r\n\t\tif (this.state.isPlaying === true) {\r\n\t\t\t// console.log(\"<SM>execute step:\", step)\r\n\t\t\tthis.executeStep(step)\r\n\t\t}\r\n\t\treturn this.currentStep.bpm\r\n\t}\r\n\r\n\texecuteStep = (step) => {\r\n\t\t// console.log('executeStep ', step)\r\n\t\tif (this.lastStep !== step) {\r\n\t\t\tthis.lastStep = step;\r\n\t\t\tthis.currentStep = step;\r\n\r\n\t\t\tif (this.getBpm() !== step.bpm) {\r\n\t\t\t\tthis.setBpm(step.bpm)\r\n\t\t\t}\r\n\t\t\tvar t = Tone;\r\n\r\n\t\t\t// const d = new Tone.Time(this.currentStep.duration, this.currentStep.playMode === playModes.BY_TIME ? 's' : 'm');\r\n\t\t\t// console.log('calc time', d.toTicks(), Tone.Transport.loopEnd)\r\n\r\n\t\t\t// if (Tone.Transport.lastLoopDuration !== this.currentStep.duration) {\r\n\t\t\t\tconst newLE =  this.currentStep.playMode === playModes.BY_TIME ?  step.duration : step.duration + 'm';\r\n\t\t\t\t// console.log('new Loop End', newLE)\r\n\t\t\t\tTone.Transport.setLoopPoints(0,  newLE);\r\n\t\t\t\tTone.Transport.lastLoopDuration = this.currentStep.duration;\r\n\t\t\t\t// Tone.Transport.loopEnd = \"1m\";//this.currentStep.playMode === playModes.BY_TIME ?  step.duration : step.duration + 'm'\r\n\t\t\t\t// console.log('Tone.Transport.loopEnd changed from', oldLE, 'to', Tone.Transport.loopEnd);\r\n\t\t\t// }\r\n\r\n\t\t}\r\n\r\n\r\n\t\tif (Tone.Transport.state === 'stopped') {\r\n\t\t\t// console.log('starting transport')\r\n\t\t\tTone.Transport.start(\"+0.01\")\r\n\t\t}\r\n\r\n\t}\r\n\r\n\trepeat = (time) => {\r\n\t\tconst idx = this.currentBeat++ % this.beatsPerStep;\r\n\r\n\t\tconst note = this.score[idx];\r\n\r\n\t\t// make sound\r\n\t\tthis.instrumentLib.getInstrument().triggerAttack(note, time);\r\n\r\n\r\n\r\n\r\n\t\t// draw stuff\r\n\t\tTone.Draw.schedule(() => this.onBeat(idx), time)\r\n\t}\r\n\r\n\tsetInstrument(instrumentKey) {\r\n\t\tthis.instrumentLib.setInstrument(instrumentKey);\r\n\t}\r\n\r\n\tgetCurrentInstrumentLabel() {\r\n\t\treturn this.instrumentLib.getInstrument().label;\r\n\t}\r\n\r\n\tsetBpm = bpm => {\r\n\r\n\t\tif (isNaN(bpm) || bpm <= 0 || bpm > 1000) {\r\n\t\t\tdebugger\r\n\t\t\tthrow new Error(\"Invalid BPM value: \" + bpm)\r\n\t\t}\r\n\r\n\t\tif (bpm != Tone.Transport.bpm.value) {\r\n\t\t\tTone.Transport.bpm.value = bpm;\r\n\t\t\tTone.Transport.loopEnd = \"1m\"\r\n\t\t\t// console.log('bpm changed to', bpm)\r\n\t\t}\r\n\t};\r\n\r\n\tsetBeatsPerStep = newBps => {\r\n\t\t// console.log(\"<SoundMachine>setBeatsPerStep\", newBps)\r\n\r\n\r\n\t\tthis.beatsPerStep = newBps;\r\n\r\n\t\t// remove if needed\r\n\t\twhile (this.score.length > newBps) {\r\n\t\t\tthis.score.pop();\r\n\t\t}\r\n\r\n\t\t// add if needed\r\n\t\twhile (this.score.length < newBps) {\r\n\t\t\tthis.score.push(accentTypes.ACCENT_1)\r\n\t\t}\r\n\r\n\t\tTone.Transport.timeSignature = newBps;//[newBps, 4];\r\n\t\tTone.Transport.loop = true;\r\n\r\n\t\t// this will refresh visualisation\r\n\t\tthis.setState({ beatsPerStep: newBps })\r\n\t};\r\n\r\n\tonBeat = (currentBeat) => {\r\n\t\tthis.props.onBeat(currentBeat);\r\n\r\n\t\t// this.fft.connect(Tone.Master);\r\n\r\n\t\t// console.log('beat', this.fft.getValue())\r\n\t}\r\n\r\n\tsetAccents(accentTypesArr) {\r\n\t\tthis.accents = accentTypesArr;\r\n\r\n\t\tfor (let i = 0; i < this.score.length; i++) {\r\n\t\t\t// by default 2 will be the tick note\r\n\t\t\tlet note = this.accentNotes[accentTypes.ACCENT_2];\r\n\r\n\t\t\t// if accent for this step is specified set it here\r\n\t\t\tif (\r\n\t\t\t\taccentTypesArr[i] !== undefined &&\r\n\t\t\t\taccentTypesArr[i] === accentTypes.ACCENT_1\r\n\t\t\t) {\r\n\t\t\t\tnote = this.accentNotes[accentTypes.ACCENT_1];\r\n\t\t\t} else if (\r\n\t\t\t\taccentTypesArr[i] !== undefined &&\r\n\t\t\t\taccentTypesArr[i] === accentTypes.ACCENT_3\r\n\t\t\t) {\r\n\t\t\t\tnote = this.accentNotes[accentTypes.ACCENT_3];\r\n\t\t\t}\r\n\t\t\tthis.score[i] = note;\r\n\t\t}\r\n\t}\r\n\r\n\thandleStartStop = () => {\r\n\t\t// console.log(\"<SM>HandleStartStop, state:\", Tone.Transport.state)\r\n\r\n\t\tif (Tone.Transport.state === 'started') {\r\n\t\t\tthis.stop();\r\n\r\n\t\t} else {\r\n\t\t\tthis.start(this.currentStep);\r\n\t\t}\r\n\t};\r\n\r\n\trender() {\r\n\t\treturn (\r\n\r\n\t\t\t<Button\r\n\t\t\t\toutline\r\n\t\t\t\tcolor=\"light\"\r\n\t\t\t\tonClick={() => this.handleStartStop()}\r\n\t\t\t\tblock\r\n\t\t\t\tactive={this.state.isPlaying}\r\n\t\t\t>\r\n\t\t\t\tStart / Stop\r\n\t\t\t</Button>\r\n\r\n\t\t\t// <div style={{width: '100%'}}>\r\n\t\t\t// \t{/* <div>Sound is {this.state.isPlaying === true ? \"playing\" : \"stopped\"}</div> */}\r\n\t\t\t// \t{/* <SimpleVis ref=\"vis\" beats={this.state.beatsPerStep}/> */}\r\n\t\t\t// </div>\r\n\t\t);\r\n\t}\r\n\r\n\tsetVis(vis) {\r\n\t\tthis.vis = vis;\r\n\t}\r\n\tstop() {\r\n\t\t// console.log('<SM>stop')\r\n\t\tthis.setState({ isPlaying: false });\r\n\t\tthis.currentBeat = 0;\r\n\t\tTone.Transport.stop();\r\n\t}\r\n\r\n\tstart(step) {\r\n\t\t// console.log('<SM>Start')\r\n\t\tthis.setState({ isPlaying: true }, this.executeStep(step));\r\n\r\n\t}\r\n\r\n\tgetBpm = () => {\r\n\t\treturn Tone.Transport.bpm.value;\r\n\t};\r\n}\r\n\r\nexport default SoundMachine;\r\n\r\n\r\nSoundMachine.defaultProps = {\r\n\tbeatsPerStep: 4,\r\n\tonLoopEnd: function (time) { },\r\n\tonToggle: function (state) { },\r\n\tonProgress: function (progress) { }\r\n};","import React, { Component } from 'react';\r\nimport {Container} from 'reactstrap';\r\n\r\nclass SimpleProgress extends Component {\r\n    state = {  }\r\n    render() { \r\n        return ( <Container className=\"SimpleProgress\">\r\n            <div className=\"bar\" style={{width: this.props.value  + \"%\", display: 'block'}} />\r\n        </Container> );\r\n    }\r\n}\r\n \r\nexport default SimpleProgress;","const Utils = {\r\n    padTime: function(t) {\r\n\t\treturn t < 10 ? \"0\" + t : t;\r\n\t},\r\n\tformatTime: function(timeInSeconds) {\r\n\t\t//{this.leadingZeroCheck(now.getMinutes())}:{now.getSeconds()} --\r\n\t\tlet t = new Date(0, 0, 0, 0, 0, 0, 0);\r\n\t\tt.setSeconds(timeInSeconds);\r\n\t\tlet m = t.getMinutes();\r\n\t\tlet o = \"\";\r\n\t\tif (m !== 0) {\r\n\t\t\to += t.getMinutes(); //this.padTime(t.getMinutes());\r\n            o += \":\";\r\n            o += \"\" + Utils.padTime(t.getSeconds());\r\n        }\r\n        else {\r\n            o += t.getSeconds();\r\n        }\r\n\t\treturn o;\r\n    }\r\n}\r\n\r\nexport default Utils;","import React, { Component } from \"react\";\r\nimport { Badge } from \"reactstrap\";\r\nimport { playModes } from \"./PlayModes\";\r\nimport SimpleProgress from \"./SimpleProgress\";\r\nimport Utils from \"./Utils\";\r\n\r\nclass Planner extends Component {\r\n\tstate = {\r\n\t\tbars: [],\r\n\t\tstepProgress: 0,\r\n\t\tisPaused: false\r\n\t};\r\n\r\n\ttimer = {\r\n\t\tref: null,\r\n\t\tstartTime: null\r\n\t};\r\n\tstepsCounter = 0;\r\n\t// stepProgressUpdateInterval = 1000 / 30; // 30 fps\r\n\r\n\tmakePlan(s) {\r\n\t\tlet segments = [];\r\n\r\n\t\tif (s.playMode === playModes.BY_BAR) {\r\n\t\t\tconst min = s.bpmRange[0];\r\n\t\t\tconst max = s.bpmRange[1];\r\n\t\t\tlet bpm = min;\r\n\t\t\twhile (bpm <= max) {\r\n\t\t\t\tlet segment = {\r\n\t\t\t\t\tbpm: bpm,\r\n\t\t\t\t\tduration: s.interval,\r\n\t\t\t\t\tend: s.interval \t// TODO <--- remove this \r\n\t\t\t\t};\r\n\t\t\t\tsegments.push(segment);\r\n\t\t\t\tbpm += s.bpmStep;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (s.playMode === playModes.BY_TIME) {\r\n\t\t\tconst min = s.bpmRange[0];\r\n\t\t\tconst max = s.bpmRange[1];\r\n\t\t\tlet bpm = min;\r\n\r\n\t\t\tlet i = 0;\r\n\t\t\twhile (bpm <= max) {\r\n\t\t\t\tlet segment = {\r\n\t\t\t\t\ttime: i * s.interval,\r\n\t\t\t\t\tstart: i * s.interval,\r\n\t\t\t\t\tend: i * s.interval + s.interval,\r\n\t\t\t\t\tduration: s.interval,\r\n\t\t\t\t\tbpm: bpm\r\n\t\t\t\t};\r\n\t\t\t\tsegments.push(segment);\r\n\t\t\t\tbpm += s.bpmStep;\r\n\t\t\t}\r\n\t\t} else if (s.playMode === playModes.STABLE) {\r\n\t\t\tlet segment = {\r\n\t\t\t\ttime: Infinity, // TODO <--remove\r\n\t\t\t\tduration: Infinity,\r\n\t\t\t\tbpm: s.stableBpmSlider\r\n\t\t\t};\r\n\t\t\tsegments.push(segment);\r\n\t\t}\r\n\t\treturn segments;\r\n\t}\r\n\r\n\t// TODO: this is ugly\r\n\tsetPlan(uiStateObject) {\r\n\t\t// debugger\r\n\t\tconst plan = this.makePlan(uiStateObject);\r\n\r\n\t\t// console.log(\"<Planner>setPlan\", plan);\r\n\t\tvar bars = [];\r\n\r\n\t\tlet totalPlanTime = 0;\r\n\t\tconst playMode = uiStateObject.playMode;\r\n\t\tlet i = 0;\r\n\r\n\t\tswitch (uiStateObject.playMode) {\r\n\t\t\tcase playModes.BY_BAR:\r\n\t\t\t\tfor (i = 0; i < plan.length; i++) {\r\n\t\t\t\t\tconst bar = {\r\n\t\t\t\t\t\tbpm: plan[i].bpm,\r\n\t\t\t\t\t\tduration: plan[i].end,\r\n\t\t\t\t\t\tend: plan[i].end,\r\n\t\t\t\t\t\tstep: this.stepsCounter++,\r\n\t\t\t\t\t\tplayMode: playModes.BY_BAR\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\ttotalPlanTime +=\r\n\t\t\t\t\t\t(60 / plan[i].bpm) *\r\n\t\t\t\t\t\tuiStateObject.beatsPerStep *\r\n\t\t\t\t\t\tplan[i].end;\r\n\t\t\t\t\tbars.push(bar);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase playModes.BY_TIME:\r\n\t\t\t\tfor (i = 0; i < plan.length; i++) {\r\n\t\t\t\t\tconst bar = {\r\n\t\t\t\t\t\ttime: plan[i].time,\r\n\t\t\t\t\t\tduration: plan[i].end - plan[i].time,\t// TODO: remove other unnecesary parameters\r\n\t\t\t\t\t\ttimeEnd: plan[i].end,\r\n\t\t\t\t\t\tsegmentDuration: plan[i].end - plan[i].time,\r\n\t\t\t\t\t\tstartTimeFormatted: Utils.formatTime(plan[i].start),\r\n\t\t\t\t\t\tendTimeFormatted: Utils.formatTime(plan[i].end),\r\n\t\t\t\t\t\tbpm: plan[i].bpm,\r\n\t\t\t\t\t\tplayMode: playModes.BY_TIME,\r\n\t\t\t\t\t\tstep: this.stepsCounter++\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\ttotalPlanTime += plan[i].end;\r\n\r\n\t\t\t\t\tbars.push(bar);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase playModes.STABLE:\r\n\t\t\t\ttotalPlanTime = Infinity;\r\n\t\t\t\tbars.push({\r\n\t\t\t\t\tbpm: plan[0].bpm,\r\n\t\t\t\t\tduration: Infinity,\r\n\t\t\t\t\tplayMode: playModes.STABLE,\r\n\t\t\t\t\ttime: Infinity,\r\n\t\t\t\t\tstep: 0\r\n\t\t\t\t});\r\n\t\t\t\tconsole.log(\"plan set to play at {0} bpm\", plan[0].bpm);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// update to new state\r\n\t\tthis.stepsCounter = 0;\r\n\r\n\t\tthis.setState(\r\n\t\t\tprevState => ({\r\n\t\t\t\ttotalPlanTime: totalPlanTime,\r\n\t\t\t\tcurrentStep: 0,\r\n\t\t\t\tbars: bars,\r\n\t\t\t\tplayMode: playMode\r\n\t\t\t}),\r\n\t\t\t() => this.stepChanged()\r\n\t\t);\r\n\t}\r\n\r\n\tstop() {\r\n\t\t// console.log(\"lockBpm\", this.props.lockBpm);\r\n\t\tthis.pause();\r\n\t\tthis.resetStep();\r\n\t}\r\n\r\n\tsetStep(stepIdx) {\r\n\t\tconsole.log('this.state.currentStep !== stepIdx',this.state.currentStep , stepIdx)\r\n\r\n\t\tif (this.state.currentStep !== stepIdx) {\r\n\t\t\tthis.setState({currentStep: stepIdx}, this.stepChanged)\r\n\t\t}\r\n\t}\r\n\r\n\tisLastStep() {\r\n\t\treturn this.state.currentStep === this.state.bars.length -1;\r\n\t}\r\n\t\r\n\tisFirstStep() {\r\n\t\treturn this.state.currentStep === 0;\r\n\t}\r\n\r\n\r\n\tstepForward() {\r\n\t\tconsole.log(\"<Planner>stepForward()\")\r\n\t\t// check if we're not at the end of plan\r\n\t\tif (this.state.currentStep + 1 < this.state.bars.length) {\r\n\t\t\tthis.setStep(this.state.currentStep + 1)\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.log('no more steps')\r\n\t\t}\r\n\t}\r\n\r\n\tstepBackward() {\r\n\t\tconsole.log(\"<Planner>stepBackward()\")\r\n\r\n\r\n\t\tif (this.state.currentStep - 1 >= 0) {\r\n\t\t\tthis.setStep(this.state.currentStep - 1)\r\n\t\t}\r\n\t}\r\n\r\n\t// onInterval() {\r\n\t// \tthis.stepForward();\r\n\t// \t// if (this.timer) {\r\n\t// \t// \t// set time when we changed step to be able to render progress easily\r\n\t// \t// \tthis.timer.startTime = new Date();\r\n\t// \t// }\r\n\t// }\r\n\r\n\tstart() {\r\n\t\t\r\n\t}\r\n\r\n\tsetProgress(progress) {\r\n\t\tthis.setState({stepProgress: progress});\r\n\t}\r\n\t\r\n\t\r\n\t// planChanged = () => {\r\n\t// \tconsole.log(\"<Planner>planChanged\");\r\n\t// \tthis.stepChanged();\r\n\t// };\r\n\r\n\tstepChanged() {\r\n\t\tconsole.log(\"<Planner>stepChanged\")\r\n\t\tconst step = this.getCurrentStep();\r\n\t\tthis.props.onStep(step);\r\n\t}\r\n\r\n\tresetStep() {\r\n\t\tconsole.log('<Planner> resetStep()')\r\n\t\tthis.setStep(0)\r\n\t}\r\n\r\n\tgetCurrentStep() {\r\n\t\tif (this.state.currentStep >= this.state.bars.length) {\r\n\t\t\tthrow new Error(\"Trying to get step that doesn't exists\");\r\n\t\t}\r\n\t\treturn this.state.bars[this.state.currentStep];\r\n\t}\r\n\r\n\t// onStepClick(idx) {\r\n\t// \tthis.setStep(idx)\r\n\t// }\r\n\r\n\tbarRender = b => {\r\n\t\tconst cls = this.state.currentStep === b.step ? \"current-step\" : \"\";\r\n\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tonClick={() => this.setStep(b.step)}\r\n\t\t\t\tclassName={\"step \" + cls}\r\n\t\t\t\tkey={\"key_\" + b.bpm}\r\n\t\t\t>\r\n\t\t\t\t{b.segmentDuration !== undefined\r\n\t\t\t\t\t? Utils.formatTime(b.segmentDuration.toFixed(0)) + \" \"\r\n\t\t\t\t\t: b.end + \" bars \"}\r\n\t\t\t\tat {b.bpm.toFixed(0)}\r\n\t\t\t</div>\r\n\t\t);\r\n\t};\r\n\r\n\tformatTime(date) {\r\n\t\treturn date.getMinutes() + \":\" + date.getSeconds();\r\n\t}\r\n \r\n\trender() {\r\n\t\tif (this.state.bars.length === 0) {\r\n\t\t\treturn <div>No plan</div>;\r\n\t\t}\r\n\t\telse if (this.state.bars[0].time === Infinity) {\r\n\t\t\treturn (\r\n\t\t\t\t<div>\r\n\t\t\t\t\t{/* Playing at constant speed {this.state.bars[0].bpm} bpm */}\r\n\t\t\t\t\t<h2><Badge color=\"dark\">BPM: {this.props.currentBpm}</Badge></h2>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"Planner\">\r\n\t\t\t\t<h2><Badge color=\"dark\">BPM: {this.props.currentBpm}</Badge></h2>\r\n\t\t\t\t{/* <div>Next step in {this.state.stepProgress.toFixed(1)} seconds</div> */}\r\n\t\t\t\t<SimpleProgress value={this.state.stepProgress * 100} />\r\n\r\n\t\t\t\t{/* <Button onClick={() => this.togglePause()}>\r\n\t\t\t\t\tisPaused:\r\n\t\t\t\t\t{this.state.isPaused === true ? \"paused\" : \"normal\"}\r\n\t\t\t\t</Button> */}\r\n\r\n\t\t\t\t<div style={this.props.lockBpm ? { opacity: 0.5 } : {}}>\r\n\t\t\t\t\t{this.state.bars.map(bar => this.barRender(bar))}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\tTotal time: {Utils.formatTime(this.state.totalPlanTime)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default Planner;\r\n\r\nPlanner.defaultProps = {\r\n\tplayMode: playModes.BY_BAR,\r\n\tcurrentStep: 0,\r\n\tonStep: function(step) {}\r\n};\r\n","import React from \"react\";\r\nimport Slider from \"rc-slider\";\r\nimport { Badge  } from \"reactstrap\";\r\n// import {Container, Row, Col} from 'reactstrap'\r\n\r\nclass AdvancedSlider extends Slider {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<Badge\r\n\t\t\t\t\t\tcolor=\"light\"\r\n\t\t\t\t\t\t// onClick={this.onBadgeClick}\r\n\t\t\t\t\t\tclassName=\"d-i\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{this.state.value}\r\n\t\t\t\t\t</Badge>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style={{ height: \"30px\" }}>\r\n\t\t\t\t\t<div>{super.render()}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n\r\n\tonBadgeClick() {\r\n\t\t// TODO attach editorInPlace\r\n\t}\r\n}\r\n\r\nexport default AdvancedSlider;\r\n\r\n","import React, { Component } from \"react\";\r\n\r\nclass Accent extends Component {\r\n\tstate = {\r\n\t\tisCurrent: false\r\n\t};\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div className={\"Accent \" + (this.state.isCurrent === true ? \"active\" : \"\")}  onClick={this.props.onClick}>\r\n\t\t\t\t<div className={\"type\" + this.props.type}></div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\ttoggleCurrent() {\r\n\t\tthis.setState({isCurrent: !this.state.isCurrent})\r\n\t}\r\n}\r\n\r\nexport default Accent;\r\n","import React, { Component } from \"react\";\r\nimport { accentTypesArr } from \"./AccentTypes\";\r\nimport Accent from \"./Accent\";\r\n\r\nclass BarManager extends Component {\r\n\tstate = {\r\n\t\tbars: []\r\n\t};\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state.bars = props.defaultValue;\r\n\t}\r\n\r\n\tsetAccents(accents, beatsPerStep) {\r\n\t\tthis.setState({ bars: accents }, this.props.onAfterChange);\r\n\t}\r\n\r\n\thandleCellClick(selected) {\r\n\t\tlet newBars = [...this.state.bars];\r\n\t\t\r\n\t\tconst type = newBars[selected];\r\n\t\t// set new type\r\n\t\tnewBars[selected] = accentTypesArr[(type + 1) % 3];;\r\n\t\t\r\n\t\tthis.setState({bars: newBars}, this.props.onAfterChange)\r\n\t}\r\n\r\n\tgetAccents() {\r\n\t\treturn this.state.bars;\r\n\t}\r\n\r\n\tsetActive(idx) {\r\n\t\t// unselect previous element\r\n\t\tif (this.lastActiveAccent) {\r\n\t\t\tthis.lastActiveAccent.toggleCurrent();\r\n\t\t\tthis.lastActiveAccent = undefined\r\n\t\t}\r\n\t\t// select new \r\n\t\tconst el = this.refs[\"accent\" + idx];\r\n\r\n\t\t// make sure it exits though\r\n\t\tif (el) {\r\n\t\t\tel.toggleCurrent();\r\n\t\t\tthis.lastActiveAccent = el;\r\n\t\t}\r\n\t}\r\n \r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t{this.state.bars.map((bar, idx) => (\r\n\t\t\t\t\t<Accent ref={\"accent\" + idx}\r\n\t\t\t\t\t\ttype={bar}\r\n\t\t\t\t\t\tonClick={() => this.handleCellClick(idx)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t))}\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default BarManager;\r\n","import React, { Component } from \"react\";\r\nimport {\r\n\tInput,\r\n\tButton,\r\n\tModal,\r\n\tModalHeader,\r\n\tModalBody,\r\n\tModalFooter\r\n} from \"reactstrap\";\r\n\r\nclass EditPresetModal extends Component {\r\n\tstate = {\r\n\t\tmodal: false,\r\n\t\tpreset: null,\r\n\t\tshowDelete: false\r\n\t};\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.state = {\r\n\t\t\tmodal: false\r\n\t\t};\r\n\t\tthis.toggle = this.toggle.bind(this);\r\n\t}\r\n\r\n\ttoggle() {\r\n\t\tthis.setState(prevState => ({\r\n\t\t\tmodal: !prevState.modal\r\n\t\t}));\r\n\t}\r\n\r\n\thandleSave() {\r\n\t\tconst preset = this.state.preset;\r\n\t\tconst title = this.state.preset.title;\r\n\t\tif (title && title.length > 0) {\r\n\t\t\tthis.props.onSave(title, preset);\r\n\t\t\tthis.toggle();\r\n\t\t}\r\n\t}\r\n\r\n\tedit(preset, showDelete) {\r\n\t\tthis.setState(\r\n\t\t\t{\r\n\t\t\t\tpreset: preset,\r\n\t\t\t\tshowDelete: showDelete\r\n\t\t\t},\r\n\t\t\tthis.toggle\r\n\t\t);\r\n\t}\r\n\r\n\ttitleChanged(e) {\r\n\t\tconst newTitle = e.target.value;\r\n\t\tlet preset = { ...this.state.preset };\r\n\t\tpreset.title = newTitle;\r\n\t\tthis.setState({ preset });\r\n\t\t// this.setState()\r\n\t\t// this.setState({title: e.target.value}\r\n\t}\r\n\r\n\tonDeleteBtn() {\r\n\t\tthis.props.onDeleteBtn(this.state.preset);\r\n\t\tthis.toggle();\r\n\t}\r\n\r\n\trenderDelete() {\r\n\t\t \r\n\t\tif (this.state.showDelete === true) {\r\n\t\t\treturn(<Button color=\"warning\" onClick={() => this.onDeleteBtn()}>\r\n\t\t\t\tDelete\r\n\t\t\t\t</Button>\r\n\t\t\t);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<Button\r\n\t\t\t\t\toutline\r\n\t\t\t\t\tsize=\"sm\"\r\n\t\t\t\t\tcolor=\"light\"\r\n\t\t\t\t\tonClick={this.props.onSaveBtn}\r\n\t\t\t\t>\r\n\t\t\t\t\tSave Preset\r\n\t\t\t\t</Button>\r\n\t\t\t\t<Modal\r\n\t\t\t\t\tisOpen={this.state.modal}\r\n\t\t\t\t\ttoggle={this.toggle}\r\n\t\t\t\t\tclassName={this.props.className}\r\n\t\t\t\t>\r\n\t\t\t\t\t<ModalHeader toggle={this.toggle}>Save Preset</ModalHeader>\r\n\t\t\t\t\t<ModalBody>\r\n\t\t\t\t\t\t<Input\r\n\t\t\t\t\t\t\tonChange={e => this.titleChanged(e)}\r\n\t\t\t\t\t\t\tdefaultValue={\r\n\t\t\t\t\t\t\t\t(this.state.preset &&\r\n\t\t\t\t\t\t\t\t\tthis.state.preset.title) ||\r\n\t\t\t\t\t\t\t\t\"\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<div className=\"code\">\r\n\t\t\t\t\t\t\t{JSON.stringify(this.state.preset)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</ModalBody>\r\n\t\t\t\t\t<ModalFooter>\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\tcolor=\"primary\"\r\n\t\t\t\t\t\t\tonClick={() => this.handleSave()}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tSave\r\n\t\t\t\t\t\t</Button>{\" \"}\r\n\t\t\t\t\t\t<Button color=\"secondary\" onClick={this.toggle}>\r\n\t\t\t\t\t\t\tCancel\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t{this.renderDelete()}\r\n\t\t\t\t\t</ModalFooter>\r\n\t\t\t\t</Modal>\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default EditPresetModal;\r\n\r\n\r\nEditPresetModal.defaultProps = {\r\n\tonDeleteBtn: function(preset) {},\r\n\tonSave: function(title, preset) {},\r\n\tonSaveBtn: function(e, idx) {}\r\n };\r\n","import React, { Component } from \"react\";\r\nimport {Container, Row, Col } from \"reactstrap\";\r\nimport EditPresetModal from \"./EditPresetModal\"\r\n\r\nclass PresetsManager extends Component {\r\n\tstate = {\r\n\t\tshowDelete: [],\r\n\t\tshowEdit: []\r\n\t};\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.userPresets = this.props.cookies.get('userPresets');\r\n\t\t\r\n\t\tthis.state.showDelete = this.userPresets ? Array(this.userPresets.length).fill(false) : []\r\n\t\tthis.state.showEdit = this.userPresets ? Array(this.userPresets.length).fill(false) : []\r\n\t}\r\n\t\r\n\tonPresetClick(preset) {\r\n\t\tthis.props.onSelect(preset);\r\n\t}\r\n\r\n\tonSavePreset(title, o) {\r\n\t\tconst preset = {title: title, ...o}\r\n\t\t\r\n\t\tlet userPresets = this.props.cookies.get('userPresets');\r\n\r\n\t\tif (!userPresets) {\r\n\t\t\tuserPresets = [];\r\n\t\t}\r\n\t\t\r\n\t\t// overwrite by title \r\n\t\tlet idx = -1;\r\n\r\n\t\tfor (let i = 0 ; i < userPresets.length; i++) {\r\n\t\t\tif (userPresets[i].title.toLowerCase() === title.toLowerCase()) {\r\n\t\t\t\tidx = i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (idx < 0) {\r\n\t\t\tuserPresets.push(preset)\r\n\t\t}\r\n\t\telse {\r\n\t\t\tuserPresets[idx] = preset;\r\n\t\t}\r\n\r\n\t\tthis.saveInCookie(userPresets);\r\n\t}\r\n\r\n\tsaveInCookie(presets) {\r\n\t\tthis.props.cookies.set('userPresets', JSON.stringify(presets),{ path: '/' });\r\n\t\tthis.userPresets = presets;\r\n\t}\r\n\r\n\tshowDeleteBtn(e, idx) {\r\n\t\tlet showDelete = {...this.state};\r\n\t\tshowDelete[idx] = true;\r\n\t\tthis.setState({showDelete});\r\n\t}\r\n\r\n\tshowEditBtn(e, idx) {\r\n\t\tlet showEdit = {...this.state};\r\n\t\tshowEdit[idx] = true;\r\n\t\tthis.setState({showEdit});\r\n\t}\r\n\thideEditBtn(e) {\r\n\t\tthis.setState({showEdit: false})\r\n\t}\r\n\r\n\tonPresetDelete(preset) {\r\n\t\tlet idx = this.userPresets.indexOf(preset) \r\n\t\tif (idx < 0) {\r\n\t\t\tthrow new Error(\"Selected preset \" +  preset.title + \" has not been found in the store\" )\r\n\t\t}\r\n\t\tthis.userPresets.splice(idx,1);\r\n\t\tthis.saveInCookie(this.userPresets);\r\n\t}\r\n\r\n\tonPresetEdit(e, idx) {\r\n\t\t// console.log('preset EDIT',e,idx);\r\n\t\t/// prevent from triggerring onClick \r\n\t\te.stopPropagation()\r\n\t\t\r\n\r\n\t\tif (idx !== undefined) {\r\n\t\t\tthis.refs.presetEditor.edit(this.userPresets[idx], true)\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// new preset\r\n\t\t\tvar p = this.props.getPreset();\r\n\t\t\tthis.refs.presetEditor.edit(p)\r\n\t\t}\r\n\t}\r\n\r\n\tsetPreset(preset) {\r\n\t\t\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst userPresets = this.props.cookies.cookies.userPresets ?  JSON.parse(  this.props.cookies.cookies.userPresets ) : [];\r\n\t\t// // console.log('<PresetsManager>userPresets', userPresets)\r\n\t\treturn (\r\n\t\t\t<Container className=\"PresetsManager\">\r\n\t\t\t\t<Row>\r\n\t\t\t\t\t{this.props.presets.map((item, idx) => (\t\t\t\t\t\t\r\n\t\t\t\t\t\t<Col className=\"preset\" hidden={item.isHidden}\r\n\t\t\t\t\t\t\tonClick={() => this.onPresetClick(item)}\r\n\t\t\t\t\t\t\tkey={\"preset_\" + idx}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{item.title}\r\n\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t))}\r\n\t\t\t\t</Row>\r\n\t\t\t\t<Row>\r\n\t\t\t\t\tmy presets:\r\n\t\t\t\t</Row>\r\n\t\t\t\t<Row>\r\n\t\t\t\t\t{userPresets.map((item, idx) => (\r\n\t\t\t\t\t\t<Col className=\"preset\"\r\n\t\t\t\t\t\t\tonMouseEnter={(e) => this.showEditBtn(e, idx)}\r\n\t\t\t\t\t\t\tonMouseLeave={(e) => this.hideEditBtn(e, idx)}\r\n\t\t\t\t\t\t\tonClick={() => this.onPresetClick(item)}\r\n\t\t\t\t\t\t\tkey={\"preset_\" + idx}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{item.title}\r\n\t\t\t\t\t\t\t<div class='x' style={{visibility: this.state.showEdit[idx] ? '' : 'hidden'}} onClick={(e) => this.onPresetEdit(e,idx)}>Edit</div>\r\n\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t))}\r\n\t\t\t\t</Row>\r\n\t\t\t\t<Row>\r\n\t\t\t\t\t<EditPresetModal ref='presetEditor' onDeleteBtn={(preset) => this.onPresetDelete(preset)} onSaveBtn={(e,idx) => this.onPresetEdit(e,idx)} onSave={(title, preset) => this.onSavePreset(title, preset)}/>\r\n\t\t\t\t</Row>\r\n\t\t\t</Container>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default PresetsManager;\r\n\r\nPresetsManager.defaultProps = {\r\n\tonSelect: function(preset) {}\r\n };","import React, { Component } from 'react';\r\nimport {Container, Row} from 'reactstrap'\r\n\r\nclass SimplePanel extends Component {\r\n    render() { \r\n        return (\r\n            <Container className={\"pane \" + this.props.className}>\r\n\t\t\t\t<Row className=\"pane-title\">{this.props.title}</Row>\r\n\t\t\t\t<Row className=\"pane-body\">{this.props.children}</Row>\r\n            </Container>\r\n            );\r\n    }\r\n}\r\n \r\nexport default SimplePanel;\r\n\r\n\r\nSimplePanel.defaultProps = {\r\n    title: 'title',\r\n    children: [],\r\n    className: ''\r\n };","export const playbackModes = {\r\n\tSTOP: \"stop\",\r\n\tCYCLE: \"cycle\",\r\n\tREPEAT: \"repeat\",\r\n\tCONTINUE: \"continue\"\r\n};","import React, { Component } from 'react';\r\nimport Slider from 'rc-slider'\r\nimport regression from 'regression';\r\nimport {Badge} from 'reactstrap'\r\n\r\n\r\nclass GeometricSlider extends Component {\r\n\tstate = {\r\n        value: undefined,\r\n        regression: undefined\r\n\t};\r\n\r\n    constructor(props) {\r\n        // TOneverDo \r\n        // currently it works only for min=1 only\r\n        super(props);\r\n        \r\n        const d = [[0,this.props.min],  [100, this.props.max]];\r\n        \r\n        this.state.regression = regression.exponential(d, {precision : 10 })\r\n        console.log('slider func', this.state.regression.string)\r\n\r\n        this.prepareMarks();\r\n\r\n        this.state.value = this.props.defaultValue;\r\n        \r\n    }\r\n\r\n    prepareMarks() {\r\n        this.marks = {};\r\n        \r\n        for (let i = 0; i < this.props.marksAt.length; i++) {\r\n            this.marks[  this.findX(this.props.marksAt[i]) ]  = this.props.marksAt[i];\r\n        }\r\n    }\r\n\r\n    makeMark(value) {\r\n        return {\r\n            label: this.props.markFormatter(\r\n                Math.floor(value)\r\n            ),\r\n            style: this.props.marksStyle\r\n        };\r\n    }\r\n\r\n    onChange(v) {\r\n        console.log('onChange', v)\r\n        const value =  Math.floor(this.state.regression.predict(v)[1]);\r\n        this.setState({value: value})\r\n        this.props.onChange(value)\r\n    }\r\n \r\n    findX(y) {\r\n        // y = e^bx ==> x = ln(y) / b\r\n        return Math.log(y)/this.state.regression.equation[1];\r\n    }\r\n    \r\n    setValue(v) {\r\n        this.setState({value: v})\r\n    }\r\n\r\n    render() {\r\n        return(\r\n            <>\r\n            \t<div>\r\n\t\t\t\t\t<Badge  color=\"light\" onClick={this.onBadgeClick} className=\"d-i\">\r\n                        {this.props.badgeFormatter(this.state.value)}\r\n\t\t\t\t\t</Badge>\r\n\t\t\t\t</div>\r\n                <Slider ref=\"slider\" included={false} value={this.findX(this.state.value)} style={{height: '45px'}} onChange={(v) => this.onChange(v)} min={0} max={100} step={0.5} marks={this.marks}/>\r\n            </>\r\n        )\r\n\r\n    }\r\n    \r\n}\r\n \r\nexport default GeometricSlider;\r\n\r\nGeometricSlider.defaultProps = {\r\n    marksNum: 6,\r\n    marksStyle: {\r\n        color: '#ccc'\r\n    },\r\n    desc: '',\r\n    badgeFormatter: function(v) {return v;},\r\n    markFormatter: function(v) {return v;},\r\n    defaultValue: 50,\r\n    marksAt: []\r\n}","import React from \"react\";\r\nimport { Range } from \"rc-slider\";\r\nimport { Badge } from \"reactstrap\";\r\n\r\nclass AdvancedRange extends Range {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<Badge\r\n\t\t\t\t\t\tcolor=\"light\"\r\n\t\t\t\t\t\t// onClick={this.onBadgeClick}\r\n\t\t\t\t\t\tclassName=\"d-i\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{this.state.bounds[0]} - {this.state.bounds[1]}\r\n\t\t\t\t\t</Badge>\r\n\t\t\t\t</div>\r\n                <div style={{ height: \"30px\" }}>\r\n                {super.render()}\r\n                </div>\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default AdvancedRange;\r\n","import React, { Component } from \"react\";\r\nimport SimplePanel from \"./SimplePanel\";\r\nimport {\r\n\tButtonGroup,\r\n\tButton,\r\n\tCollapse,\r\n\tButtonDropdown,\r\n\tDropdownToggle,\r\n\tDropdownItem,\r\n\tDropdownMenu\r\n} from \"reactstrap\";\r\nimport { playModes } from \"./PlayModes\";\r\nimport { playbackModes } from \"./PlaybackModes\";\r\nimport GeometricSlider from \"./GeometricSlider\";\r\nimport AdvancedRange from \"./AdvancedRange\"\r\nimport AdvancedSlider from \"./AdvancedSlider\"\r\nimport Utils from \"./Utils\";\r\n\r\nclass ModePanel extends Component {\r\n\tstate = {\r\n\t\tplaybackMode: playbackModes.STOP,\r\n\t\tplayMode: playModes.BY_TIME,\r\n\t\tbpmStep: 10,\r\n\t\tbpmStepDropdownOpen: false,\r\n\t\tbyTimeInterval: 5,\r\n\t\tbyBarInterval: 2,\r\n\t\tstableBpmSlider: 300,\r\n\t\tbpmRange: [100, 250]\r\n\t};\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state.playMode = props.playMode;\r\n\t\tif (props.playMode === playModes.BY_BAR) {\r\n\t\t\tthis.state.byBarInterval = props.interval;\r\n\t\t} else {\r\n\t\t\tthis.state.byTimeInterval = props.interval;\r\n\t\t}\r\n\t\tthis.state.bpmStep = props.bpmStep;\r\n\t\tthis.state.bpmRange = props.bpmRange;\r\n\t\tconsole.log('<ModePanel> constructor')\r\n\t}\r\n\r\n\tonModeChange(newMode) {\r\n\t\tthis.setState({ playMode: newMode }, this.props.onAfterChange);\r\n\t}\r\n\r\n\r\n\tonBpmRangeChange(bpmRange) {\r\n\t\tconsole.log('<ModePanel>onBpmRangeChange(' + bpmRange[0] + ')')\r\n\t\tthis.setState({ bpmRange: bpmRange }, this.props.onAfterChange);\r\n\t}\r\n\r\n\tonBpmSliderChange = (value) => {\r\n\t\tconsole.log('onBpmSliderChange', value)\r\n\t\tthis.setState({ stableBpmSlider: value }, this.props.onAfterChange);\r\n\t}\r\n\r\n\tonBpmStepChange() {\r\n\t\tthis.setState(prevState => ({\r\n\t\t\tbpmStepDropdownOpen: !prevState.bpmStepDropdownOpen\r\n\t\t}));\r\n\t}\r\n\r\n\tonBpmStepSelect(value) {\r\n\t\tthis.setState({ bpmStep: value }, this.props.onAfterChange);\r\n\t}\r\n\r\n\tgetValue() {\r\n\r\n\t\tconsole.log('getValue', this.state.playbackMode)\r\n\r\n\t\tconst o = {\r\n\t\t\tplayMode: this.state.playMode,\r\n\t\t\tplaybackMode: this.state.playbackMode,\r\n\t\t\tinterval:\r\n\t\t\t\tthis.state.playMode === playModes.BY_BAR\r\n\t\t\t\t\t? this.state.byBarInterval\r\n\t\t\t\t\t: this.state.byTimeInterval,\r\n\t\t\tbpmStep: this.state.bpmStep,\r\n\t\t\tbpmRange: this.state.playMode !== playModes.STABLE ? this.state.bpmRange : this.props.bpmRange,//this.refs.bpmRange.getValue() : null,\r\n\t\t\tstableBpmSlider: this.state.stableBpmSlider\r\n\t\t};\r\n\t\t// debugger\r\n\t\treturn o;\r\n\t}\r\n\r\n\tsetValue(o) {\r\n\t\tconsole.log(\"<ModePanel>setValue\", o)\r\n\t\tthis.setState(\r\n\t\t\t{\r\n\t\t\t\tplayMode: o.playMode,\r\n\t\t\t\tplayBackMode: o.playBackMode || this.state.playBackMode,\r\n\t\t\t\tbpmStep: o.bpmStep,\r\n\t\t\t\tbyBarInterval:\r\n\t\t\t\t\to.playMode === playModes.BY_BAR\r\n\t\t\t\t\t\t? o.interval\r\n\t\t\t\t\t\t: this.state.byBarInterval,\r\n\t\t\t\tbyTimeInterval:\r\n\t\t\t\t\to.playMode === playModes.BY_TIME\r\n\t\t\t\t\t\t? o.interval\r\n\t\t\t\t\t\t: this.state.byTimeInterval,\r\n\t\t\t\tbpmRange: o.bpmRange,\r\n\t\t\t\tstableBpmSlider: o.stableBpmSlider || this.state.stableBpmSlider\r\n\t\t\t},\r\n\t\t\tthis.props.onAfterChange\r\n\t\t);\r\n\r\n\r\n\t\tconst slider =\r\n\t\t\to.playMode === playModes.BY_BAR\r\n\t\t\t\t? this.refs.byBarSlider\r\n\t\t\t\t: this.refs.byTimeSlider;\r\n\t\tslider.setValue(o.interval);\r\n\r\n\t\tthis.refs.bpmRange.setState({ bounds: o.bpmRange })\r\n\t}\r\n\r\n\tonTimeIntervalChange(v) {\r\n\t\tthis.setState({ byTimeInterval: v }, this.props.onAfterChange);\r\n\t}\r\n\r\n\tonBarIntervalChange(v) {\r\n\t\tthis.setState({ byBarInterval: v }, this.props.onAfterChange);\r\n\t}\r\n\r\n\tbyBarFormatter(barsNum) {\r\n\t\tlet s = barsNum + \" \";\r\n\t\tif (barsNum === 1) {\r\n\t\t\ts += \"bar\";\r\n\t\t} else {\r\n\t\t\ts += \"bars\";\r\n\t\t}\r\n\t\treturn s;\r\n\t}\r\n\r\n\tbyTimeFormatter(time) {\r\n\t\tlet s = Utils.formatTime(time) + \" \";\r\n\r\n\t\tif (time === 1) {\r\n\t\t\ts += \"second\";\r\n\t\t} else if (time < 60) {\r\n\t\t\ts += \"seconds\";\r\n\t\t} else if (time < 120) {\r\n\t\t\ts += \"minute\";\r\n\t\t} else {\r\n\t\t\ts += \"minutes\";\r\n\t\t}\r\n\t\treturn s;\r\n\t}\r\n\r\n\tonPlaybackChange(newPlaybackMode) {\r\n\t\tthis.setState({ playbackMode: newPlaybackMode });\r\n\t}\r\n\r\n\trenderIncreaseBpmDropdown() {\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\tincrease speed by\r\n\t\t\t\t<ButtonDropdown\r\n\t\t\t\t\tstyle={{ margin: \"0px 5px\" }}\r\n\t\t\t\t\tisOpen={this.state.bpmStepDropdownOpen}\r\n\t\t\t\t\ttoggle={() => this.onBpmStepChange()}\r\n\t\t\t\t>\r\n\t\t\t\t\t<DropdownToggle caret size=\"sm\" outline color=\"light\">\r\n\t\t\t\t\t\t{this.state.bpmStep}\r\n\t\t\t\t\t</DropdownToggle>\r\n\t\t\t\t\t<DropdownMenu>\r\n\t\t\t\t\t\t<DropdownItem\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tthis.onBpmStepSelect(5);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t5\r\n\t\t\t\t\t\t</DropdownItem>\r\n\t\t\t\t\t\t<DropdownItem\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tthis.onBpmStepSelect(10);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t10\r\n\t\t\t\t\t\t</DropdownItem>\r\n\t\t\t\t\t\t<DropdownItem\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tthis.onBpmStepSelect(20);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t20\r\n\t\t\t\t\t\t</DropdownItem>\r\n\t\t\t\t\t\t<DropdownItem\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tthis.onBpmStepSelect(30);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t30\r\n\t\t\t\t\t\t</DropdownItem>\r\n\t\t\t\t\t\t<DropdownItem\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tthis.onBpmStepSelect(50);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t50\r\n\t\t\t\t\t\t</DropdownItem>\r\n\t\t\t\t\t</DropdownMenu>\r\n\t\t\t\t</ButtonDropdown>\r\n\t\t\t\tbpm\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n\r\n\trenderSpeedRange() {\r\n\r\n\t\t// console.log('renderSpeedRange', this.state.bpmRange[0])\r\n\t\treturn (<div>\r\n\t\t\tSpeed range\r\n\t\t\t<AdvancedRange\r\n\t\t\t\tref=\"bpmRange\"\r\n\t\t\t\tmin={30}\r\n\t\t\t\tmax={600}\r\n\t\t\t\tdefaultValue={[\r\n\t\t\t\t\tthis.state.bpmRange[0],\r\n\t\t\t\t\tthis.state.bpmRange[1]\r\n\t\t\t\t]}\r\n\t\t\t\tpushable={true}\r\n\t\t\t\tonAfterChange={(value) => this.onBpmRangeChange(value)}\r\n\t\t\t/>\r\n\t\t</div>);\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<SimplePanel className=\"ModePanel\" title=\"Mode\">\r\n\t\t\t\t<ButtonGroup size=\"sm\">\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\tsize=\"sm\"\r\n\t\t\t\t\t\toutline\r\n\t\t\t\t\t\tcolor=\"light\"\r\n\t\t\t\t\t\tonClick={() => this.onModeChange(playModes.BY_BAR)}\r\n\t\t\t\t\t\tactive={this.state.playMode === playModes.BY_BAR}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tBy bar\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\tsize=\"sm\"\r\n\t\t\t\t\t\toutline\r\n\t\t\t\t\t\tcolor=\"light\"\r\n\t\t\t\t\t\tonClick={() => this.onModeChange(playModes.BY_TIME)}\r\n\t\t\t\t\t\tactive={this.state.playMode === playModes.BY_TIME}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tBy time\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\tsize=\"sm\"\r\n\t\t\t\t\t\toutline\r\n\t\t\t\t\t\tcolor=\"light\"\r\n\t\t\t\t\t\tonClick={() => this.onModeChange(playModes.STABLE)}\r\n\t\t\t\t\t\tactive={this.state.playMode === playModes.STABLE}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tStable\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</ButtonGroup>\r\n\r\n\t\t\t\t<Collapse isOpen={this.state.playMode !== playModes.STABLE}>\r\n\t\t\t\t\t{/* {this.state.playMode !== playModes.STABLE ? this.renderSpeedRange() : ''} */}\r\n\t\t\t\t\t{this.renderSpeedRange()}\r\n\t\t\t\t</Collapse>\r\n\r\n\r\n\t\t\t\t<Collapse isOpen={this.state.playMode === playModes.BY_BAR}>\r\n\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\tIncrease speed every\r\n\t\t\t\t\t\t<GeometricSlider\r\n\t\t\t\t\t\t\tref=\"byBarSlider\"\r\n\t\t\t\t\t\t\tdefaultValue={this.state.byBarInterval}\r\n\t\t\t\t\t\t\tbadgeFormatter={this.byBarFormatter}\r\n\t\t\t\t\t\t\tonChange={v => this.onBarIntervalChange(v)}\r\n\t\t\t\t\t\t\tmin={1}\r\n\t\t\t\t\t\t\tmax={301}\r\n\t\t\t\t\t\t\tmarksAt={[1, 2, 5, 10, 20, 50, 100, 300]}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</Collapse>\r\n\t\t\t\t<Collapse isOpen={this.state.playMode === playModes.BY_TIME}>\r\n\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\tIncrease speed every\r\n\t\t\t\t\t\t<GeometricSlider\r\n\t\t\t\t\t\t\tref=\"byTimeSlider\"\r\n\t\t\t\t\t\t\tdefaultValue={this.state.byTimeInterval}\r\n\t\t\t\t\t\t\tbadgeFormatter={this.byTimeFormatter}\r\n\t\t\t\t\t\t\tmarkFormatter={Utils.formatTime}\r\n\t\t\t\t\t\t\tonChange={v => this.onTimeIntervalChange(v)}\r\n\t\t\t\t\t\t\tmin={1}\r\n\t\t\t\t\t\t\tmax={600}\r\n\t\t\t\t\t\t\tmarksAt={[1, 2, 5, 10, 30, 60, 120, 240, 600]}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</Collapse>\r\n\t\t\t\t{this.state.playMode !== playModes.STABLE ? this.renderIncreaseBpmDropdown() : ''}\r\n\t\t\t\t<Collapse isOpen={this.state.playMode === playModes.STABLE}>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\tChoose bpm\r\n\r\n\t\t\t\t\t\t<AdvancedSlider\r\n\t\t\t\t\t\t\tref=\"stableBpmSlider\"\r\n\t\t\t\t\t\t\tincluded={false}\r\n\t\t\t\t\t\t\tmin={10}\r\n\t\t\t\t\t\t\tmax={600}\r\n\t\t\t\t\t\t\tmarks={{ 30: '30', 100: '100', 200: '200', 300: '300', 400: '400', 500: '500', 600: '600' }}\r\n\t\t\t\t\t\t\tvalue={this.state.stableBpmSlider}\r\n\t\t\t\t\t\t\tonChange={this.onBpmSliderChange}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</Collapse>\r\n\r\n\t\t\t\t<Collapse isOpen={this.state.playMode !== playModes.STABLE}>\r\n\t\t\t\t\t<div>After plan</div>\r\n\t\t\t\t\t<ButtonGroup size=\"sm\">\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\tsize=\"sm\"\r\n\t\t\t\t\t\t\toutline\r\n\t\t\t\t\t\t\tcolor=\"light\"\r\n\t\t\t\t\t\t\tonClick={() => this.onPlaybackChange(playbackModes.STOP)}\r\n\t\t\t\t\t\t\tactive={this.state.playbackMode === playbackModes.STOP}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tStop\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\tsize=\"sm\"\r\n\t\t\t\t\t\t\toutline\r\n\t\t\t\t\t\t\tcolor=\"light\"\r\n\t\t\t\t\t\t\tonClick={() => this.onPlaybackChange(playbackModes.CYCLE)}\r\n\t\t\t\t\t\t\tactive={this.state.playbackMode === playbackModes.CYCLE}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tCycle back\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\tsize=\"sm\"\r\n\t\t\t\t\t\t\toutline\r\n\t\t\t\t\t\t\tcolor=\"light\"\r\n\t\t\t\t\t\t\tonClick={() => this.onPlaybackChange(playbackModes.CONTINUE)}\r\n\t\t\t\t\t\t\tactive={this.state.playbackMode === playbackModes.CONTINUE}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tLast speed\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\tsize=\"sm\"\r\n\t\t\t\t\t\t\toutline\r\n\t\t\t\t\t\t\tcolor=\"light\"\r\n\t\t\t\t\t\t\tonClick={() => this.onPlaybackChange(playbackModes.REPEAT)}\r\n\t\t\t\t\t\t\tactive={this.state.playbackMode === playbackModes.REPEAT}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tStart over\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t</ButtonGroup>\r\n\t\t\t\t</Collapse>\r\n\t\t\t</SimplePanel>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default ModePanel;\r\n\r\nModePanel.defaultProps = {\r\n\tonAfterChange: null\r\n};\r\n","import {playModes} from \"./PlayModes\"\r\nimport {playbackModes} from \"./PlaybackModes\"\r\nimport { instruments } from \"./InstrumentLib\";\r\n\r\n\r\nexport const PresetsLib = [\r\n    {\r\n        title: \"4 beats every 4 bars\",\r\n        beatsPerStep: 4,\r\n        playMode: playModes.BY_BAR,\r\n        interval: 4,\r\n        bpmStep: 20,\r\n        bpmRange: [100, 400],\r\n        accents: [0, 1, 2, 1]\r\n    },\r\n    {\r\n        title: \"Jhaptal tabla\",\r\n        instrument: instruments.TABLA,\r\n\t\tbeatsPerStep: 10,\r\n\t\tbpmRange: [200, 400],\r\n        accents: [0, 1, 0, 0, 1, 2, 1, 0, 0, 1 ],\r\n        playMode: playModes.BY_TIME,\r\n        interval: 5*60,\r\n        bpmStep: 10\r\n    },\r\n    {title: \"Balkan 1\", \"bpmRange\":[241,400],\"beatsPerStep\":7,\"accents\":[0,1,2,0,1,2,1],\"instrument\":\"electrokit\",\"playMode\":\"by_bar\",\"interval\":20,\"bpmStep\":30},\r\n    {title: \"Balkan 2\", \"bpmRange\":[293,400],\"beatsPerStep\":7,\"accents\":[0,1,2,0,1,2,1],\"instrument\":\"tabla\",\"playMode\":\"by_bar\",\"interval\":300,\"bpmStep\":50},\r\n    {title: \"Groove 1\", \"bpmRange\":[222,262],\"beatsPerStep\":8,\"accents\":[0,2,1,2,1,0,1,1],\"instrument\":\"electrokit\",\"playMode\":\"by_time\",\"interval\":600,\"bpmStep\":50},\r\n    {title: \"Groove 2\", \"bpmRange\":[222,400],\"beatsPerStep\":8,\"accents\":[0,2,0,2,2,2,0,1],\"instrument\":\"electrokit\",\"playMode\":\"by_bar\",\"interval\":20,\"bpmStep\":50},\r\n\r\n\r\n];\r\n\r\nexport const InitPreset = {\r\n    title: \"INIT\",\r\n    instrument: instruments.TABLA,\r\n    beatsPerStep: 4,\r\n    bpmRange: [300, 400],\r\n    accents: [1, 0, 0, 0],\r\n    playMode: playModes.BY_TIME,\r\n    playbackMode: playbackModes.STOP,\r\n    interval: 10,\r\n    bpmStep: 50,\r\n    isHidden: true\r\n}","import React, { Component } from \"react\";\nimport \"./App.css\";\nimport \"./components/SoundMachine\";\nimport SoundMachine from \"./components/SoundMachine\";\nimport Planner from \"./components/Planner\";\nimport \"rc-slider/assets/index.css\";\nimport \"bootstrap/dist/css/bootstrap.css\";\nimport { Container, Row, Col } from \"reactstrap\";\nimport {\n\tButtonDropdown,\n\tDropdownToggle,\n\tDropdownMenu,\n\tDropdownItem\n} from \"reactstrap\";\nimport AdvancedSlider from \"./components/AdvancedSlider\";\nimport BarManager from \"./components/BarManager\";\nimport { instruments } from \"./components/InstrumentLib\";\nimport PresetsManager from \"./components/PresetsManager\";\nimport ModePanel from \"./components/ModePanel\";\nimport { playModes } from \"./components/PlayModes\";\nimport { withCookies } from \"react-cookie\";\nimport { PresetsLib, InitPreset } from \"./components/PresetsLib\";\nimport { accentTypes } from \"./components/AccentTypes\";\nimport SimplePanel from \"./components/SimplePanel\";\nimport Vis from \"./components/Vis\"\nimport { playbackModes } from \"./components/PlaybackModes\";\n\nclass App extends Component {\n\tstate = {\n\t\tcurrentBpm: 60,\n\t\tinstrument: instruments.ELECTRO_KIT,\n\t\tinstrumentDropdownOpen: false,\n\t\tinstrumentDropdownLabel: \"Electro kit\", // bit messy, why would we hardcode this here, it ought to be taken from instrumentLib\n\t\tcycleDropdownOpen: false\n\t};\n\n\tplaybackDirection = true; // true => forward, false => backward\n\n\tcomponentDidMount() {\n\t\t// initialize accents\n\t\tthis.refs.sm.setAccents(this.refs.barManager.getAccents());\n\t\t\n\t\t// keyboard listeners\n\t\tdocument.addEventListener(\"keydown\", e => this.handleKeyDown(e));\n\n\t\t// initialize with UI settings\n\t\tthis.refs.planner.setPlan(this.getUiState());\n\t\t\n\t\t// this.refs.sm.setBpm(this.state.currentBpm)\n\t\t// this.initialized = true;\n\t\t\n\t\tthis.refs.sm.setVis(this.refs.vis)\n\t}\n\n\n\thandleKeyDown(e) {\n\t\t// console.log(\"key\", e);\n\t\tswitch (e.keyCode) {\n\t\t\tcase 32: // space\n\t\t\t\t// e.preventDefault();\n\t\t\t\tif (this.refs.sm.state.isPlaying) {\n\t\t\t\t\tthis.refs.planner.stepForward();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.refs.sm.handleStartStop();\n\t\t\t\t}\n\t\t\t\t// if (this.state.keysActive) {\n\t\t\t\t// \te.preventDefault();\n\t\t\t\t// }\n\t\t\t\t\n\t\t\t\tbreak;\n\t\t\tcase 38: // Arrow up\n\t\t\t\te.preventDefault();\n\t\t\t\tif (this.state.currentBpm < 600) {\n\t\t\t\t\tthis.setBpm(this.state.currentBpm + 10);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 40: // arrow down\n\t\t\t\te.preventDefault();\n\t\t\t\tif (this.state.currentBpm > 10) {\n\t\t\t\t\tthis.setBpm(this.state.currentBpm - 10);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 37: // Arrow left\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.refs.planner.stepBackward();\n\t\t\t\tbreak;\n\t\t\tcase 39: // Arrow right\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.refs.planner.stepForward();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t}\n\t}\n\n\tonInstrumentSelect(newInstrument) {\n\t\tthis.refs.sm.setInstrument(newInstrument);\n\t\tconst label = this.refs.sm.getCurrentInstrumentLabel();\n\t\t// trigger storing current instrument. Bit clunky...\n\n\t\t\n\t\tthis.setState({\n\t\t\tinstrument: newInstrument,\n\t\t\tinstrumentDropdownLabel: label\n\t\t}, this.getUiState);\n\t\t\n\t\t\n\t}\n\n\n\t// TODO: make it automatic\n\trenderInstrumentsDropDown() {\n\t\treturn (<ButtonDropdown\n\t\t\tisOpen={this.state.instrumentDropdownOpen}\n\t\t\ttoggle={() => this.onInstrumentChange()}\n\t\t>\n\t\t\t<DropdownToggle\n\t\t\t\tcaret\n\t\t\t\tsize=\"sm\"\n\t\t\t\toutline\n\t\t\t\tcolor=\"light\"\n\t\t\t>\n\t\t\t\t{this.state.instrumentDropdownLabel}\n\t\t\t</DropdownToggle>\n\t\t\t<DropdownMenu>\n\t\t\t\t<DropdownItem\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tthis.onInstrumentSelect(\n\t\t\t\t\t\t\tinstruments.TABLA\n\t\t\t\t\t\t);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\tTabla\n\t\t\t\t</DropdownItem>\n\t\t\t\t<DropdownItem\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tthis.onInstrumentSelect(\n\t\t\t\t\t\t\tinstruments.ELECTRO_KIT\n\t\t\t\t\t\t);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\tElectro Kit\n\t\t\t\t</DropdownItem>\n\t\t\t\t<DropdownItem\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tthis.onInstrumentSelect(\n\t\t\t\t\t\t\tinstruments.METRONOME\n\t\t\t\t\t\t);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\tMetronome\n\t\t\t\t</DropdownItem>\n\t\t\t</DropdownMenu>\n\t\t</ButtonDropdown>);\n\n\t}\n\trenderPlaybackPane() {\n\t\treturn (\n\t\t\t<Container className=\"pane\">\n\t\t\t\t<Row className=\"pane-title\">PLAYBACK</Row>\n\t\t\t\t<Row>\n\t\t\t\t\t<Col xs=\"3\">Instrument</Col>\n\t\t\t\t\t<Col>\n\t\t\t\t\t\t{this.renderInstrumentsDropDown()}\n\t\t\t\t\t</Col>\n\t\t\t\t</Row>\n\n\t\t\t\t<Row>\n\t\t\t\t\t<Col xs={3}>Beats per step</Col>\n\t\t\t\t\t<Col>\n\t\t\t\t\t\t<AdvancedSlider\n\t\t\t\t\t\t\tref=\"beatsPerStep\"\n\t\t\t\t\t\t\tmin={2}\n\t\t\t\t\t\t\tmax={16}\n\t\t\t\t\t\t\tdefaultValue={this.props.beatsPerStep}\n\t\t\t\t\t\t\tonAfterChange={() => this.onBeatsPerStepChange()}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Col>\n\t\t\t\t</Row>\n\n\t\t\t\t<Row>\n\t\t\t\t\t<Col xs={3}>Accents</Col>\n\t\t\t\t\t<Col>\n\t\t\t\t\t\t<BarManager\n\t\t\t\t\t\t\tonAfterChange={() => this.onAccentsChange()}\n\t\t\t\t\t\t\tref=\"barManager\"\n\t\t\t\t\t\t\tdefaultValue={this.props.accents}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Col>\n\t\t\t\t</Row>\n\n\t\t\t\t{/* <Row>\n\t\t\t\t\t<Col xs=\"3\">Playback</Col>\n\t\t\t\t\t<Col>One Time/LoopBack/Repeat</Col>\n\t\t\t\t</Row> */}\n\t\t\t</Container>\n\t\t);\n\t}\n\n\tonModePanelChanged() {\n\t\t// console.log(\"<App>onModePanelChanged\")\n\t\tconst state = this.getUiState();\n\t\t\n\t\t// create new plan\n\t\tthis.refs.planner.setPlan(state);\n\t}\n\t\n\trenderRightPane() {\n\t\treturn (\n\t\t\t<Container>\n\t\t\t\t<Row>\n\t\t\t\t\t<Col>{this.renderPresetsPane()}</Col>\n\t\t\t\t</Row>\n\t\t\t</Container>\n\t\t);\n\t}\n\n\tonProgress(progress) {\n\t\tthis.refs.planner.setProgress(progress)\n\t}\n\n\trenderLeftPane() {\n\t\treturn (\n\t\t\t<Container>\n\t\t\t\t<Row>\n\t\t\t\t\t<Col>\n\t\t\t\t\t\t<SimplePanel title=\"Control\">\n\t\t\t\t\t\t\t<SoundMachine\n\t\t\t\t\t\t\t\tref=\"sm\"\n\t\t\t\t\t\t\t\tbeatsPerStep={this.state.beatsPerStep}\n\t\t\t\t\t\t\t\tonLoopEnd={() => this.onLoopEnd()}\n\t\t\t\t\t\t\t\tonBeat={beat => this.onBeat(beat)}\n\t\t\t\t\t\t\t\tinstrument={this.state.instrument}\n\t\t\t\t\t\t\t\t// onToggle={(state) => this.onSoundMachineToggle(state)}\n\t\t\t\t\t\t\t\tonProgress={(progress) => this.onProgress(progress)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t</SimplePanel>\n\t\t\t\t\t</Col>\n\t\t\t\t</Row>\n\t\t\t\t<Row>\n\t\t\t\t\t<Col>\n\t\t\t\t\t\t<ModePanel\n\t\t\t\t\t\t\tref=\"modePanel\"\n\t\t\t\t\t\t\tplayMode={this.props.playMode}\n\t\t\t\t\t\t\tinterval={this.props.interval}\n\t\t\t\t\t\t\tbpmStep={this.props.bpmStep}\n\t\t\t\t\t\t\tbpmRange={this.props.bpmRange}\n\t\t\t\t\t\t\t//bpmStableSlider={this.props.bpmStableSlider}\n\t\t\t\t\t\t\tcurrentBpm={this.state.currentBpm}\n\t\t\t\t\t\t\t// defaultValue={{playMode: this.props.playMode, interval: this.props.interval, bpmStep: this.props.bpmStep}}\n\t\t\t\t\t\t\tonAfterChange={() => this.onModePanelChanged()}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Col>\n\t\t\t\t</Row>\n\n\t\t\t\t<Row>\n\t\t\t\t\t<Col>{this.renderPlaybackPane()}</Col>\n\t\t\t\t</Row>\n\t\t\t\t{/* <Row>\n\t\t\t\t\t<Col>{this.renderCyclePane()}</Col>\n\t\t\t\t</Row> */}\n\t\t\t</Container>\n\t\t);\n\t}\n\n\trenderPresetsPane() {\n\t\treturn (\n\t\t\t<Container className=\"pane\">\n\t\t\t\t<Row className=\"pane-title\">Presets</Row>\n\t\t\t\t<PresetsManager\n\t\t\t\t\tref=\"presetsManager\"\n\t\t\t\t\tcookies={this.props.cookies}\n\t\t\t\t\tpresets={PresetsLib}\n\t\t\t\t\tgetPreset={() => this.getUiState()}\n\t\t\t\t\tonSelect={preset => this.onPresetSelect(preset)}\n\t\t\t\t/>\n\t\t\t</Container>\n\t\t);\n\t}\n\n\tonPresetSelect(preset) {\n\t\t// console.log(\"setting preset\", preset);\n\n\t\tthis.refs.beatsPerStep.setState({ value: preset.beatsPerStep });\n\n\t\tthis.refs.sm.setBeatsPerStep(preset.beatsPerStep);\n\t\t\n\t\tthis.onInstrumentSelect(preset.instrument || instruments.TABLA);\n\n\t\tthis.refs.barManager.setAccents(preset.accents, preset.beatsPerStep);\n\t\t\n\t\tthis.refs.modePanel.setValue(preset);\n\t\t\n\t}\n\n\trenderMidPane() {\n\t\treturn (\n\t\t\t<Container>\n\t\t\t\t<Row>\n\t\t\t\t\t<Col>\n\t\t\t\t\t\t<SimplePanel title={\"Plan\"}>\n\t\t\t\t\t\t<Planner\n\t\t\t\t\t\t\tcurrentBpm={this.state.currentBpm}\n\t\t\t\t\t\t\t// onChange={() => this.onPlanChanged()}\n\t\t\t\t\t\t\tonStep={step => this.onPlanStep(step)}\n\t\t\t\t\t\t\tref=\"planner\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t</SimplePanel>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\n\t\t\t\t\t</Col>\n\t\t\t\t</Row>\n\t\t\t\t<Row>\n\t\t\t\t\t<Col>\n\t\t\t\t\t\t<SimplePanel title={\"Visualisation\"}>\n\t\t\t\t\t\t<Vis ref=\"vis\"/>\n\t\t\t\t\t\t</SimplePanel>\n\t\t\t\t\t</Col>\n\t\t\t\t</Row>\n\t\t\t\t\n\t\t\t</Container>\n\t\t);\n\t}\n\n\tonLoopEnd() {\n\t\t\n\t\tconst pm = this.refs.modePanel.state.playbackMode;\n\t\t\n\t\tswitch (pm)\n\t\t{\n\t\t\tcase playbackModes.CYCLE:\n\t\t\t\tif (this.refs.planner.isLastStep() || this.refs.planner.isFirstStep()) {\n\t\t\t\t\tthis.playbackDirection = !this.playbackDirection;\n\t\t\t\t}\n\t\t\t\tthis.playbackDirection === true ? this.refs.planner.stepForward() : this.refs.planner.stepBackward();\n\t\t\t\tbreak;\n\t\t\tcase playbackModes.REPEAT:\n\t\t\t\tif (this.refs.planner.isLastStep()) {\n\t\t\t\t\tthis.refs.planner.setStep(0)\n\t\t\t\t} else {\n\t\t\t\t\tthis.refs.planner.stepForward();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase playbackModes.CONTINUE: \n\t\t\t\tif (this.refs.planner.isLastStep()) {\n\t\t\t\t\tlet currentMode = this.refs.modePanel.getValue();\n\t\t\t\t\tcurrentMode.playMode = playModes.STABLE;\n\t\t\t\t\tcurrentMode.stableBpmSlider = this.state.currentBpm;\n\t\t\t\t\tthis.refs.modePanel.setValue(currentMode);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.refs.planner.stepForward();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase playbackModes.STOP: \n\t\t\t\tif (this.refs.planner.isLastStep()) {\n\t\t\t\t\tthis.refs.sm.handleStartStop();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.refs.planner.stepForward();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault: \n\t\t\t\tthis.refs.planner.stepForward();\t\t\n\t\t}\n\t}\n\n\tonBeat(idx) {\n\t\tthis.refs.barManager.setActive(idx);\n\t}\n\t \n\trender() {\n\t\t// set the title with current BPM\n\t\tdocument.title =\n\t\t\t\"BPM: \" + this.state.currentBpm.toFixed(0) + \" | SpeedTrainer\"\n\n\t\t// render everything else\n\t\treturn (\n\t\t\t<div className=\"App\">\n\t\t\t\t\n\t\t\t\t<Container className=\"app-container\">\n\t\t\t\t\t<Row>\n\t\t\t\t\t\t<Col>\n\t\t\t\t\t\t\t{/* left pane with controls */}\n\t\t\t\t\t\t\t{this.renderLeftPane()}\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t<Col>{this.renderMidPane()}</Col>\n\t\t\t\t\t</Row>\n\t\t\t\t\t<Row>\n\t\t\t\t\t\t<Col>\n\t\t\t\t\t\t\t{/* right pane with examples and plan*/}\n\t\t\t\t\t\t\t{this.renderRightPane()}\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t</Row>\n\t\t\t\t</Container>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tonBeatsPerStepChange = () => {\n\t\t// plan doesn't change here, just the beats per step amount\n\t\tconst newBps = this.getUiState().beatsPerStep;\n\n\t\tif (newBps !== this.refs.sm.beatsPerStep) {\n\t\t\tconst accents = this.refs.barManager.getAccents();\n\n\t\t\twhile (accents.length > newBps) {\n\t\t\t\taccents.pop();\n\t\t\t}\n\t\t\twhile (accents.length < newBps) {\n\t\t\t\taccents.push(accentTypes.ACCENT_2);\n\t\t\t}\n\n\t\t\tthis.refs.sm.setBeatsPerStep(newBps);\n\t\t\tthis.refs.barManager.setAccents(accents);\n\t\t\tthis.setState({ beatsPerStep: newBps });\n\t\t}\n\t};\n\n\tonPlanStep(step) {\n\t\t// console.log(\"<App>onPlanStep\", step)\n\t\t// this.setBpm(step.bpm);\n\n\t\tif (step) {\n\t\t\tthis.setState({currentBpm: this.refs.sm.setStep(step)});\n\t\t}\n\t}\n\n\n\tsetBpm = newBpm => {\n\t\tthis.setState({ currentBpm: newBpm });\n\t\tthis.refs.sm.setBpm(newBpm);\n\t};\n\t\n\tonInstrumentChange() {\n\t\tthis.setState(prevState => ({\n\t\t\tinstrumentDropdownOpen: !prevState.instrumentDropdownOpen\n\t\t}));\n\t\t\n\t}\n\n\t\n\tgetUiState() {\n\n\t\tconst s1 = {\n\t\t\tbeatsPerStep: this.refs.beatsPerStep.getValue(),\n\t\t\taccents: this.refs.barManager.getAccents(),\n\t\t\tinstrument: this.state.instrument\n\t\t};\n\n\t\tconst s2 = this.refs.modePanel.getValue();\n// console.log('s2',s2.playbac)\n\t\tconst uiState = { ...s1, ...s2 };\n\t\t\n\t\t// console.log(\"storing uiState\", this.uiState);\n\t\tthis.uiState = uiState;\n\t\t// HACK\n\t\t\n\n\t\tthis.uiState.instrument = this.state.instrument;\n\t\t// console.log('uiState instrument',this.uiState.instrument)\n\t\treturn uiState;\n\t}\n\n\tonAccentsChange() {\n\t\tthis.refs.sm.setAccents(this.refs.barManager.getAccents());\n\t}\n}\n\nexport default withCookies(App);\n\n// this serves as default app settings\nApp.defaultProps = {\n\tplaybackMode: InitPreset.playbackMode,\n\tplayMode: InitPreset.playMode,// playModes.BY_BAR,\n\tinterval: InitPreset.interval,\n\tinstrument: InitPreset.instrument,\n\tbpmStep: InitPreset.bpmStep,\n\tbpmRange: InitPreset.bpmRange,\n\tbeatsPerStep: InitPreset.beatsPerStep,\n\taccents: InitPreset.accents\n};\n\n// App.defaultProps = {...App.defaultProps, InitPreset}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport {CookiesProvider} from 'react-cookie'\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(  <CookiesProvider> <App  /> </CookiesProvider> , document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();"],"sourceRoot":""}